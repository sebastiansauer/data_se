---
draft: yes
title: Power calculation for the general linear model
author: ''
date: '2018-07-24'
slug: power-calculation-for-the-general-linear-model
categories:
  - rstats
tags:
  - rstats
---



<p>Before conducting an experiment, one should compute the power - or, preferably, estimate the precision of the expected results. There are numerous way to achieve this, here’s one using the R package <code>pwr</code>.</p>
<div id="package-pwr" class="section level1">
<h1>Package pwr</h1>
<pre class="r"><code>library(pwr)</code></pre>
<p>The workhorse function here is <code>pwr.f2.test</code>. Note that <code>f2</code> refers to the effect size <span class="math inline">\(f^2\)</span> (see <a href="https://en.wikipedia.org/wiki/Effect_size#Cohen&#39;s_%C6%922">here</a>), defined as:</p>
<p><span class="math display">\[f^2 = \frac{R^2}{1-R^2}\]</span>.</p>
<p>See for details of the function its help page:</p>
<pre class="r"><code>help(&quot;pwr.f2.test&quot;)</code></pre>
<pre><code>pwr.f2.test(u = NULL, v = NULL, f2 = NULL, sig.level = 0.05, power = NULL)</code></pre>
<p>Note that <code>u</code> is the number of predictors (<span class="math inline">\(k\)</span>) minus 1, that’s the numerator degrees of freedom (df). The intercepts counts a predictor, too in this case!</p>
<p><code>v</code> is the denominator df, defined as <span class="math inline">\(n-p\)</span>, where <span class="math inline">\(n\)</span> is the sample size (see <a href="https://math.stackexchange.com/questions/617735/multiple-regression-degrees-of-freedom-f-test">here</a> for some details on df).</p>
<p>By the way, if you wonder, what df actually are, read <a href="https://www.quora.com/How-can-I-explain-degrees-of-freedom-simply-and-clearly">this</a> nice little explanation.</p>
<p>Let’s look at one example. In a power analysis before the experiment, one states the desired level of power, and the expected effect size, for example:</p>
<pre class="r"><code># example: k=3 predictors, n=100 observations, R^2 = .1, sig.level = .05 (default)

pwr.f2.test(u = 2,
            v = 97,
            f2 = .1/.9,
            power = NULL)</code></pre>
<pre><code>## 
##      Multiple regression power calculation 
## 
##               u = 2
##               v = 97
##              f2 = 0.1111111
##       sig.level = 0.05
##           power = 0.8447176</code></pre>
<p>Given this values, we will have a power of about 84% (if all assumptions are met).</p>
<p>The other way round: How large should the sample be to get a power of .8, given <span class="math inline">\(R^2=.^1\)</span>?</p>
<pre class="r"><code># example: k=3 predictors, power = .8, R^2 = .1

pwr.f2.test(u = 2,
            f2 = .1/.9,
            power = .8,
            v = NULL)</code></pre>
<pre><code>## 
##      Multiple regression power calculation 
## 
##               u = 2
##               v = 86.77678
##              f2 = 0.1111111
##       sig.level = 0.05
##           power = 0.8</code></pre>
<p><code>v = 87</code>, ie, <span class="math inline">\(n=v+p=87+3=90\)</span>.</p>
<pre class="r"><code>lm1 &lt;- glm(am ~ hp + mpg + vs, data = mtcars, family = &quot;binomial&quot;)
str(lm1)</code></pre>
<pre><code>## List of 30
##  $ coefficients     : Named num [1:4] -36.1058 0.0512 1.4571 -2.163
##   ..- attr(*, &quot;names&quot;)= chr [1:4] &quot;(Intercept)&quot; &quot;hp&quot; &quot;mpg&quot; &quot;vs&quot;
##  $ residuals        : Named num [1:32] 1.89 1.89 2.33 -1.23 -2.1 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:32] &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...
##  $ fitted.values    : Named num [1:32] 0.53 0.53 0.428 0.189 0.524 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:32] &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...
##  $ effects          : Named num [1:32] 0.455 0.209 -1.814 1.234 -1.194 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:32] &quot;(Intercept)&quot; &quot;hp&quot; &quot;mpg&quot; &quot;vs&quot; ...
##  $ R                : num [1:4, 1:4] -1.69 0 0 0 -242.59 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:4] &quot;(Intercept)&quot; &quot;hp&quot; &quot;mpg&quot; &quot;vs&quot;
##   .. ..$ : chr [1:4] &quot;(Intercept)&quot; &quot;hp&quot; &quot;mpg&quot; &quot;vs&quot;
##  $ rank             : int 4
##  $ qr               :List of 5
##   ..$ qr   : num [1:32, 1:4] -1.695 0.294 0.292 0.231 0.295 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:32] &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...
##   .. .. ..$ : chr [1:4] &quot;(Intercept)&quot; &quot;hp&quot; &quot;mpg&quot; &quot;vs&quot;
##   ..$ rank : int 4
##   ..$ qraux: num [1:4] 1.29 1.12 1.23 1.41
##   ..$ pivot: int [1:4] 1 2 3 4
##   ..$ tol  : num 1e-11
##   ..- attr(*, &quot;class&quot;)= chr &quot;qr&quot;
##  $ family           :List of 12
##   ..$ family    : chr &quot;binomial&quot;
##   ..$ link      : chr &quot;logit&quot;
##   ..$ linkfun   :function (mu)  
##   ..$ linkinv   :function (eta)  
##   ..$ variance  :function (mu)  
##   ..$ dev.resids:function (y, mu, wt)  
##   ..$ aic       :function (y, n, mu, wt, dev)  
##   ..$ mu.eta    :function (eta)  
##   ..$ initialize:  expression({  if (NCOL(y) == 1) {  if (is.factor(y))  y &lt;- y != levels(y)[1L]  n &lt;- rep.int(1, nobs)  y[weights =| __truncated__
##   ..$ validmu   :function (mu)  
##   ..$ valideta  :function (eta)  
##   ..$ simulate  :function (object, nsim)  
##   ..- attr(*, &quot;class&quot;)= chr &quot;family&quot;
##  $ linear.predictors: Named num [1:32] 0.1219 0.1219 -0.2881 -1.4583 0.0962 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:32] &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...
##  $ deviance         : num 17.6
##  $ aic              : num 25.6
##  $ null.deviance    : num 43.2
##  $ iter             : int 8
##  $ weights          : Named num [1:32] 0.249 0.249 0.245 0.153 0.249 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:32] &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...
##  $ prior.weights    : Named num [1:32] 1 1 1 1 1 1 1 1 1 1 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:32] &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...
##  $ df.residual      : int 28
##  $ df.null          : int 31
##  $ y                : Named num [1:32] 1 1 1 0 0 0 0 0 0 0 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:32] &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...
##  $ converged        : logi TRUE
##  $ boundary         : logi FALSE
##  $ model            :&#39;data.frame&#39;:   32 obs. of  4 variables:
##   ..$ am : num [1:32] 1 1 1 0 0 0 0 0 0 0 ...
##   ..$ hp : num [1:32] 110 110 93 110 175 105 245 62 95 123 ...
##   ..$ mpg: num [1:32] 21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
##   ..$ vs : num [1:32] 0 0 1 1 0 1 0 1 1 1 ...
##   ..- attr(*, &quot;terms&quot;)=Classes &#39;terms&#39;, &#39;formula&#39;  language am ~ hp + mpg + vs
##   .. .. ..- attr(*, &quot;variables&quot;)= language list(am, hp, mpg, vs)
##   .. .. ..- attr(*, &quot;factors&quot;)= int [1:4, 1:3] 0 1 0 0 0 0 1 0 0 0 ...
##   .. .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. .. ..$ : chr [1:4] &quot;am&quot; &quot;hp&quot; &quot;mpg&quot; &quot;vs&quot;
##   .. .. .. .. ..$ : chr [1:3] &quot;hp&quot; &quot;mpg&quot; &quot;vs&quot;
##   .. .. ..- attr(*, &quot;term.labels&quot;)= chr [1:3] &quot;hp&quot; &quot;mpg&quot; &quot;vs&quot;
##   .. .. ..- attr(*, &quot;order&quot;)= int [1:3] 1 1 1
##   .. .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. .. ..- attr(*, &quot;response&quot;)= int 1
##   .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. .. ..- attr(*, &quot;predvars&quot;)= language list(am, hp, mpg, vs)
##   .. .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:4] &quot;numeric&quot; &quot;numeric&quot; &quot;numeric&quot; &quot;numeric&quot;
##   .. .. .. ..- attr(*, &quot;names&quot;)= chr [1:4] &quot;am&quot; &quot;hp&quot; &quot;mpg&quot; &quot;vs&quot;
##  $ call             : language glm(formula = am ~ hp + mpg + vs, family = &quot;binomial&quot;, data = mtcars)
##  $ formula          :Class &#39;formula&#39;  language am ~ hp + mpg + vs
##   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##  $ terms            :Classes &#39;terms&#39;, &#39;formula&#39;  language am ~ hp + mpg + vs
##   .. ..- attr(*, &quot;variables&quot;)= language list(am, hp, mpg, vs)
##   .. ..- attr(*, &quot;factors&quot;)= int [1:4, 1:3] 0 1 0 0 0 0 1 0 0 0 ...
##   .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. ..$ : chr [1:4] &quot;am&quot; &quot;hp&quot; &quot;mpg&quot; &quot;vs&quot;
##   .. .. .. ..$ : chr [1:3] &quot;hp&quot; &quot;mpg&quot; &quot;vs&quot;
##   .. ..- attr(*, &quot;term.labels&quot;)= chr [1:3] &quot;hp&quot; &quot;mpg&quot; &quot;vs&quot;
##   .. ..- attr(*, &quot;order&quot;)= int [1:3] 1 1 1
##   .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. ..- attr(*, &quot;response&quot;)= int 1
##   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. ..- attr(*, &quot;predvars&quot;)= language list(am, hp, mpg, vs)
##   .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:4] &quot;numeric&quot; &quot;numeric&quot; &quot;numeric&quot; &quot;numeric&quot;
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:4] &quot;am&quot; &quot;hp&quot; &quot;mpg&quot; &quot;vs&quot;
##  $ data             :&#39;data.frame&#39;:   32 obs. of  11 variables:
##   ..$ mpg : num [1:32] 21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
##   ..$ cyl : num [1:32] 6 6 4 6 8 6 8 4 4 6 ...
##   ..$ disp: num [1:32] 160 160 108 258 360 ...
##   ..$ hp  : num [1:32] 110 110 93 110 175 105 245 62 95 123 ...
##   ..$ drat: num [1:32] 3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
##   ..$ wt  : num [1:32] 2.62 2.88 2.32 3.21 3.44 ...
##   ..$ qsec: num [1:32] 16.5 17 18.6 19.4 17 ...
##   ..$ vs  : num [1:32] 0 0 1 1 0 1 0 1 1 1 ...
##   ..$ am  : num [1:32] 1 1 1 0 0 0 0 0 0 0 ...
##   ..$ gear: num [1:32] 4 4 4 3 3 3 3 4 4 4 ...
##   ..$ carb: num [1:32] 4 4 1 1 2 1 4 2 2 4 ...
##  $ offset           : NULL
##  $ control          :List of 3
##   ..$ epsilon: num 1e-08
##   ..$ maxit  : num 25
##   ..$ trace  : logi FALSE
##  $ method           : chr &quot;glm.fit&quot;
##  $ contrasts        : NULL
##  $ xlevels          : Named list()
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;glm&quot; &quot;lm&quot;</code></pre>
</div>

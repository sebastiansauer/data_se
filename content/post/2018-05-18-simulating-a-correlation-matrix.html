---
title: Simulating a correlation matrix.
author: Sebastian Sauer
date: '2018-05-18'
slug: simulating-a-correlation-matrix
categories:
  - rstats
tags:
  - rstats
  - simulation
  - inference
---



<p>Simulation based inference is a powerful tool as it lets you derive population estimates without having to solve difficult equations. As a more advanced example for simulation, consider the following situation. You are interested in the correlation of air time and delay of planes. More precisely you assume that this correlation is the same for different carriers (airlines). In other words, the (absolute) difference between all different pairs of correlation coefficient is zero, according to the hypothesis.</p>
<p>First, some data and the usual culprits:</p>
<pre class="r"><code>data(flights, package = &quot;nycflights13&quot;)
library(tidyverse)</code></pre>
<p>Letâ€™s check the correlation matrix consisting of the correlations for different carriers.</p>
<pre class="r"><code>flights %&gt;% 
  select(dep_delay, air_time, carrier) %&gt;% 
  drop_na() %&gt;% 
  group_by(carrier) %&gt;% 
  summarise(cor_delay_carrier = cor(dep_delay, air_time)) %&gt;% 
  mutate(cor_delay_carrier_abs = abs(cor_delay_carrier)) -&gt; cor_df</code></pre>
<pre class="r"><code>expand.grid(cor_df$cor_delay_carrier_abs,
            cor_df$cor_delay_carrier_abs)</code></pre>
<pre><code>##            Var1        Var2
## 1   0.022676575 0.022676575
## 2   0.037877115 0.022676575
## 3   0.012935020 0.022676575
## 4   0.007638039 0.022676575
## 5   0.031608228 0.022676575
## 6   0.017721413 0.022676575
## 7   0.049682072 0.022676575
## 8   0.050935167 0.022676575
## 9   0.029223215 0.022676575
## 10  0.013432516 0.022676575
## 11  0.053570335 0.022676575
## 12  0.013438495 0.022676575
## 13  0.053290753 0.022676575
## 14  0.016669352 0.022676575
## 15  0.003295770 0.022676575
## 16  0.024078316 0.022676575
## 17  0.022676575 0.037877115
## 18  0.037877115 0.037877115
## 19  0.012935020 0.037877115
## 20  0.007638039 0.037877115
## 21  0.031608228 0.037877115
## 22  0.017721413 0.037877115
## 23  0.049682072 0.037877115
## 24  0.050935167 0.037877115
## 25  0.029223215 0.037877115
## 26  0.013432516 0.037877115
## 27  0.053570335 0.037877115
## 28  0.013438495 0.037877115
## 29  0.053290753 0.037877115
## 30  0.016669352 0.037877115
## 31  0.003295770 0.037877115
## 32  0.024078316 0.037877115
## 33  0.022676575 0.012935020
## 34  0.037877115 0.012935020
## 35  0.012935020 0.012935020
## 36  0.007638039 0.012935020
## 37  0.031608228 0.012935020
## 38  0.017721413 0.012935020
## 39  0.049682072 0.012935020
## 40  0.050935167 0.012935020
## 41  0.029223215 0.012935020
## 42  0.013432516 0.012935020
## 43  0.053570335 0.012935020
## 44  0.013438495 0.012935020
## 45  0.053290753 0.012935020
## 46  0.016669352 0.012935020
## 47  0.003295770 0.012935020
## 48  0.024078316 0.012935020
## 49  0.022676575 0.007638039
## 50  0.037877115 0.007638039
## 51  0.012935020 0.007638039
## 52  0.007638039 0.007638039
## 53  0.031608228 0.007638039
## 54  0.017721413 0.007638039
## 55  0.049682072 0.007638039
## 56  0.050935167 0.007638039
## 57  0.029223215 0.007638039
## 58  0.013432516 0.007638039
## 59  0.053570335 0.007638039
## 60  0.013438495 0.007638039
## 61  0.053290753 0.007638039
## 62  0.016669352 0.007638039
## 63  0.003295770 0.007638039
## 64  0.024078316 0.007638039
## 65  0.022676575 0.031608228
## 66  0.037877115 0.031608228
## 67  0.012935020 0.031608228
## 68  0.007638039 0.031608228
## 69  0.031608228 0.031608228
## 70  0.017721413 0.031608228
## 71  0.049682072 0.031608228
## 72  0.050935167 0.031608228
## 73  0.029223215 0.031608228
## 74  0.013432516 0.031608228
## 75  0.053570335 0.031608228
## 76  0.013438495 0.031608228
## 77  0.053290753 0.031608228
## 78  0.016669352 0.031608228
## 79  0.003295770 0.031608228
## 80  0.024078316 0.031608228
## 81  0.022676575 0.017721413
## 82  0.037877115 0.017721413
## 83  0.012935020 0.017721413
## 84  0.007638039 0.017721413
## 85  0.031608228 0.017721413
## 86  0.017721413 0.017721413
## 87  0.049682072 0.017721413
## 88  0.050935167 0.017721413
## 89  0.029223215 0.017721413
## 90  0.013432516 0.017721413
## 91  0.053570335 0.017721413
## 92  0.013438495 0.017721413
## 93  0.053290753 0.017721413
## 94  0.016669352 0.017721413
## 95  0.003295770 0.017721413
## 96  0.024078316 0.017721413
## 97  0.022676575 0.049682072
## 98  0.037877115 0.049682072
## 99  0.012935020 0.049682072
## 100 0.007638039 0.049682072
## 101 0.031608228 0.049682072
## 102 0.017721413 0.049682072
## 103 0.049682072 0.049682072
## 104 0.050935167 0.049682072
## 105 0.029223215 0.049682072
## 106 0.013432516 0.049682072
## 107 0.053570335 0.049682072
## 108 0.013438495 0.049682072
## 109 0.053290753 0.049682072
## 110 0.016669352 0.049682072
## 111 0.003295770 0.049682072
## 112 0.024078316 0.049682072
## 113 0.022676575 0.050935167
## 114 0.037877115 0.050935167
## 115 0.012935020 0.050935167
## 116 0.007638039 0.050935167
## 117 0.031608228 0.050935167
## 118 0.017721413 0.050935167
## 119 0.049682072 0.050935167
## 120 0.050935167 0.050935167
## 121 0.029223215 0.050935167
## 122 0.013432516 0.050935167
## 123 0.053570335 0.050935167
## 124 0.013438495 0.050935167
## 125 0.053290753 0.050935167
## 126 0.016669352 0.050935167
## 127 0.003295770 0.050935167
## 128 0.024078316 0.050935167
## 129 0.022676575 0.029223215
## 130 0.037877115 0.029223215
## 131 0.012935020 0.029223215
## 132 0.007638039 0.029223215
## 133 0.031608228 0.029223215
## 134 0.017721413 0.029223215
## 135 0.049682072 0.029223215
## 136 0.050935167 0.029223215
## 137 0.029223215 0.029223215
## 138 0.013432516 0.029223215
## 139 0.053570335 0.029223215
## 140 0.013438495 0.029223215
## 141 0.053290753 0.029223215
## 142 0.016669352 0.029223215
## 143 0.003295770 0.029223215
## 144 0.024078316 0.029223215
## 145 0.022676575 0.013432516
## 146 0.037877115 0.013432516
## 147 0.012935020 0.013432516
## 148 0.007638039 0.013432516
## 149 0.031608228 0.013432516
## 150 0.017721413 0.013432516
## 151 0.049682072 0.013432516
## 152 0.050935167 0.013432516
## 153 0.029223215 0.013432516
## 154 0.013432516 0.013432516
## 155 0.053570335 0.013432516
## 156 0.013438495 0.013432516
## 157 0.053290753 0.013432516
## 158 0.016669352 0.013432516
## 159 0.003295770 0.013432516
## 160 0.024078316 0.013432516
## 161 0.022676575 0.053570335
## 162 0.037877115 0.053570335
## 163 0.012935020 0.053570335
## 164 0.007638039 0.053570335
## 165 0.031608228 0.053570335
## 166 0.017721413 0.053570335
## 167 0.049682072 0.053570335
## 168 0.050935167 0.053570335
## 169 0.029223215 0.053570335
## 170 0.013432516 0.053570335
## 171 0.053570335 0.053570335
## 172 0.013438495 0.053570335
## 173 0.053290753 0.053570335
## 174 0.016669352 0.053570335
## 175 0.003295770 0.053570335
## 176 0.024078316 0.053570335
## 177 0.022676575 0.013438495
## 178 0.037877115 0.013438495
## 179 0.012935020 0.013438495
## 180 0.007638039 0.013438495
## 181 0.031608228 0.013438495
## 182 0.017721413 0.013438495
## 183 0.049682072 0.013438495
## 184 0.050935167 0.013438495
## 185 0.029223215 0.013438495
## 186 0.013432516 0.013438495
## 187 0.053570335 0.013438495
## 188 0.013438495 0.013438495
## 189 0.053290753 0.013438495
## 190 0.016669352 0.013438495
## 191 0.003295770 0.013438495
## 192 0.024078316 0.013438495
## 193 0.022676575 0.053290753
## 194 0.037877115 0.053290753
## 195 0.012935020 0.053290753
## 196 0.007638039 0.053290753
## 197 0.031608228 0.053290753
## 198 0.017721413 0.053290753
## 199 0.049682072 0.053290753
## 200 0.050935167 0.053290753
## 201 0.029223215 0.053290753
## 202 0.013432516 0.053290753
## 203 0.053570335 0.053290753
## 204 0.013438495 0.053290753
## 205 0.053290753 0.053290753
## 206 0.016669352 0.053290753
## 207 0.003295770 0.053290753
## 208 0.024078316 0.053290753
## 209 0.022676575 0.016669352
## 210 0.037877115 0.016669352
## 211 0.012935020 0.016669352
## 212 0.007638039 0.016669352
## 213 0.031608228 0.016669352
## 214 0.017721413 0.016669352
## 215 0.049682072 0.016669352
## 216 0.050935167 0.016669352
## 217 0.029223215 0.016669352
## 218 0.013432516 0.016669352
## 219 0.053570335 0.016669352
## 220 0.013438495 0.016669352
## 221 0.053290753 0.016669352
## 222 0.016669352 0.016669352
## 223 0.003295770 0.016669352
## 224 0.024078316 0.016669352
## 225 0.022676575 0.003295770
## 226 0.037877115 0.003295770
## 227 0.012935020 0.003295770
## 228 0.007638039 0.003295770
## 229 0.031608228 0.003295770
## 230 0.017721413 0.003295770
## 231 0.049682072 0.003295770
## 232 0.050935167 0.003295770
## 233 0.029223215 0.003295770
## 234 0.013432516 0.003295770
## 235 0.053570335 0.003295770
## 236 0.013438495 0.003295770
## 237 0.053290753 0.003295770
## 238 0.016669352 0.003295770
## 239 0.003295770 0.003295770
## 240 0.024078316 0.003295770
## 241 0.022676575 0.024078316
## 242 0.037877115 0.024078316
## 243 0.012935020 0.024078316
## 244 0.007638039 0.024078316
## 245 0.031608228 0.024078316
## 246 0.017721413 0.024078316
## 247 0.049682072 0.024078316
## 248 0.050935167 0.024078316
## 249 0.029223215 0.024078316
## 250 0.013432516 0.024078316
## 251 0.053570335 0.024078316
## 252 0.013438495 0.024078316
## 253 0.053290753 0.024078316
## 254 0.016669352 0.024078316
## 255 0.003295770 0.024078316
## 256 0.024078316 0.024078316</code></pre>
<p>Combining all correlations with all shoud give us:</p>
<pre class="r"><code>n_carriers &lt;- length(unique(flights$carrier))</code></pre>

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.63.2" />


<title>Geoplotting - update to my MODAR-book - Data Se</title>
<meta property="og:title" content="Geoplotting - update to my MODAR-book - Data Se">



  








<link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/logo-data-se.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="/">Blog</a></li>
    
    <li><a href="/privacy/">Data privacy</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">6 min read</span>
    

    <h1 class="article-title">Geoplotting - update to my MODAR-book</h1>

    
    <span class="article-date">2019/07/29</span>
    

    <div class="article-content">
      


<p>In my <a href="https://link.springer.com/book/10.1007%2F978-3-658-21587-3">book</a> on modern data analyisis using R, I show some basics of geoplotting. It seems that some software update for the package <a href="https://github.com/r-spatial/sf">simple features</a> broke my code. So, here ’s some update.</p>
<div id="load-packages-and-data" class="section level1">
<h1>Load packages and data</h1>
<pre class="r"><code>library(tidyverse)
library(viridis)
library(sf)


data(socec, package = &quot;pradadata&quot;)
data(wahlkreise_shp, package = &quot;pradadata&quot;)</code></pre>
</div>
<div id="check-data" class="section level1">
<h1>Check data</h1>
<pre class="r"><code>glimpse(socec)
#&gt; Observations: 316
#&gt; Variables: 51
#&gt; $ V01 &lt;chr&gt; &quot;Schleswig-Holstein&quot;, &quot;Schleswig-Holstein&quot;, &quot;Schleswig-Holst…
#&gt; $ V02 &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 901, 12, 13, 14, 15, 16, …
#&gt; $ V03 &lt;chr&gt; &quot;Flensburg – Schleswig&quot;, &quot;Nordfriesland – Dithmarschen Nord&quot;…
#&gt; $ V04 &lt;int&gt; 130, 197, 178, 163, 3, 92, 49, 95, 49, 126, 28, 1110, 132, 1…
#&gt; $ V05 &lt;dbl&gt; 2128.1, 2777.0, 2000.5, 2164.8, 143.0, 1302.0, 664.3, 1333.4…
#&gt; $ V06 &lt;dbl&gt; 282.8, 232.3, 220.8, 248.7, 268.0, 219.8, 307.5, 313.2, 219.…
#&gt; $ V07 &lt;dbl&gt; 266.7, 219.7, 209.8, 239.4, 242.9, 206.8, 281.5, 294.9, 209.…
#&gt; $ V08 &lt;dbl&gt; 5.7, 5.4, 5.0, 3.7, 9.4, 5.9, 8.4, 5.8, 4.3, 6.6, 8.0, 6.3, …
#&gt; $ V09 &lt;dbl&gt; 132.9, 83.6, 110.4, 114.9, 1873.8, 168.8, 462.9, 234.9, 143.…
#&gt; $ V10 &lt;dbl&gt; -3.7, -5.0, -5.3, -3.4, -0.1, -4.9, -2.3, -1.6, -6.5, -3.7, …
#&gt; $ V11 &lt;dbl&gt; 12.3, 13.2, 11.9, 10.0, 11.9, 21.0, 13.1, 9.2, 13.2, 16.8, 1…
#&gt; $ V12 &lt;dbl&gt; 16.5, 16.1, 16.7, 17.3, 14.6, 16.4, 16.8, 17.1, 15.0, 16.8, …
#&gt; $ V13 &lt;dbl&gt; 8.7, 8.0, 7.6, 7.2, 10.8, 7.3, 7.2, 6.9, 6.7, 6.6, 8.2, 7.7,…
#&gt; $ V14 &lt;dbl&gt; 11.3, 10.4, 9.9, 9.4, 17.4, 10.1, 10.7, 10.5, 9.1, 10.1, 13.…
#&gt; $ V15 &lt;dbl&gt; 35.0, 35.1, 37.0, 37.2, 32.8, 35.8, 37.4, 37.9, 36.1, 36.9, …
#&gt; $ V16 &lt;dbl&gt; 17.4, 18.5, 17.4, 17.9, 14.8, 18.3, 16.7, 17.0, 20.0, 17.3, …
#&gt; $ V17 &lt;dbl&gt; 11.2, 11.9, 11.4, 11.0, 9.6, 12.1, 11.2, 10.5, 13.1, 12.3, 1…
#&gt; $ V18 &lt;dbl&gt; 90.0, 92.0, 90.8, 91.5, 82.0, 89.2, 85.0, 86.7, 91.6, 87.3, …
#&gt; $ V19 &lt;dbl&gt; 10.0, 8.0, 9.2, 8.5, 18.0, 10.8, 15.0, 13.3, 8.4, 12.7, 16.5…
#&gt; $ V20 &lt;dbl&gt; 5.1, 5.2, 4.2, 4.9, 7.3, 5.6, 6.4, 5.8, 6.1, 6.8, 8.1, 6.0, …
#&gt; $ V21 &lt;dbl&gt; 59.5, 65.0, 59.9, 58.3, 41.8, 54.1, 40.9, 44.1, 57.6, 44.1, …
#&gt; $ V22 &lt;dbl&gt; 35.5, 29.8, 35.9, 36.8, 50.9, 40.3, 52.7, 50.1, 36.3, 49.0, …
#&gt; $ V23 &lt;dbl&gt; 49.4, 58.8, 59.4, 58.7, 29.5, 53.0, 52.8, 54.6, 55.9, 55.6, …
#&gt; $ V24 &lt;dbl&gt; 3.8, 6.0, 2.4, 5.5, 1.3, 2.4, 6.0, 3.1, 4.7, 2.8, 2.7, 3.7, …
#&gt; $ V25 &lt;dbl&gt; 514.6, 566.1, 493.0, 492.2, 539.3, 501.9, 484.6, 469.6, 551.…
#&gt; $ V26 &lt;int&gt; 20265, 22159, 20896, 22093, 18637, 20395, 23766, 22791, 2196…
#&gt; $ V27 &lt;int&gt; 28300, 30078, 29298, 26659, 42836, 25983, 26342, 29135, 2335…
#&gt; $ V28 &lt;dbl&gt; 696.9, 748.1, 724.5, 733.3, 518.2, 673.6, 651.9, 712.1, 719.…
#&gt; $ V29 &lt;chr&gt; &quot;4,4&quot;, &quot;4&quot;, &quot;2,7&quot;, &quot;2,4&quot;, &quot;4,8&quot;, &quot;4&quot;, &quot;2,1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;2&quot;, …
#&gt; $ V30 &lt;dbl&gt; 11.9, 11.5, 11.7, 9.4, 8.7, 11.6, 11.0, 10.4, 10.0, 9.2, 9.2…
#&gt; $ V31 &lt;dbl&gt; 8.2, 7.9, 7.8, 7.4, 6.6, 7.9, 6.0, 6.2, 9.8, 6.8, 9.5, 7.5, …
#&gt; $ V32 &lt;dbl&gt; 19.8, 19.9, 19.1, 18.2, 15.2, 18.5, 14.8, 16.7, 19.4, 16.3, …
#&gt; $ V33 &lt;dbl&gt; 41.6, 48.8, 44.1, 43.6, 34.5, 39.0, 40.1, 41.2, 41.3, 39.1, …
#&gt; $ V34 &lt;dbl&gt; 30.4, 23.4, 29.0, 30.9, 43.6, 34.6, 39.1, 35.9, 29.4, 37.9, …
#&gt; $ V35 &lt;dbl&gt; 41.1, 33.9, 35.0, 37.1, 42.1, 37.5, 40.2, 47.5, 33.4, 43.1, …
#&gt; $ V36 &lt;dbl&gt; 44.0, 60.9, 43.8, 41.6, 37.9, 41.6, 48.5, 48.3, 51.1, 45.9, …
#&gt; $ V37 &lt;dbl&gt; 7.3, 9.2, 7.1, 6.9, 4.2, 6.7, 7.2, 7.3, 7.3, 6.8, 5.5, 6.9, …
#&gt; $ V38 &lt;dbl&gt; 337.4, 337.6, 290.2, 276.1, 473.7, 312.4, 290.2, 333.4, 300.…
#&gt; $ V39 &lt;chr&gt; &quot;1,6&quot;, &quot;2,6&quot;, &quot;2,7&quot;, &quot;2,4&quot;, &quot;0,2&quot;, &quot;1,7&quot;, &quot;2,3&quot;, &quot;1,1&quot;, &quot;1,5…
#&gt; $ V40 &lt;chr&gt; &quot;18,7&quot;, &quot;19,9&quot;, &quot;28,3&quot;, &quot;24,4&quot;, &quot;16&quot;, &quot;22,5&quot;, &quot;29,5&quot;, &quot;27,8&quot;…
#&gt; $ V41 &lt;chr&gt; &quot;28,1&quot;, &quot;33,4&quot;, &quot;22,9&quot;, &quot;23&quot;, &quot;20,1&quot;, &quot;29,1&quot;, &quot;29&quot;, &quot;29,3&quot;, …
#&gt; $ V42 &lt;chr&gt; &quot;16,4&quot;, &quot;12,4&quot;, &quot;15,9&quot;, &quot;15,5&quot;, &quot;25,2&quot;, &quot;17,6&quot;, &quot;17,2&quot;, &quot;17,…
#&gt; $ V43 &lt;dbl&gt; 35.2, 31.7, 30.3, 34.7, 38.6, 29.1, 22.0, 24.3, 33.4, 26.5, …
#&gt; $ V44 &lt;dbl&gt; 88.5, 70.9, 80.1, 59.4, 138.7, 86.8, 67.7, 54.5, 62.6, 59.5,…
#&gt; $ V45 &lt;dbl&gt; 26.3, 26.2, 26.0, 28.1, 26.4, 26.2, 28.8, 28.5, 24.9, 27.8, …
#&gt; $ V46 &lt;dbl&gt; 18.8, 16.7, 21.1, 23.8, 28.3, 22.1, 34.6, 28.3, 20.2, 28.7, …
#&gt; $ V47 &lt;dbl&gt; 7.2, 7.2, 6.6, 5.1, 8.8, 6.9, 5.2, 4.6, 6.2, 4.8, 8.7, 6.4, …
#&gt; $ V48 &lt;dbl&gt; 8.2, 7.7, 7.2, 5.5, 10.0, 7.5, 5.6, 4.9, 6.6, 5.1, 9.4, 6.9,…
#&gt; $ V49 &lt;dbl&gt; 6.2, 6.6, 6.0, 4.7, 7.6, 6.4, 4.8, 4.2, 5.7, 4.5, 8.0, 5.8, …
#&gt; $ V50 &lt;dbl&gt; 4.2, 3.6, 5.2, 3.2, 6.1, 4.4, 3.3, 2.7, 3.7, 3.2, 5.7, 4.0, …
#&gt; $ V51 &lt;dbl&gt; 7.3, 8.4, 6.6, 5.6, 8.7, 7.7, 6.4, 5.1, 7.4, 5.5, 9.0, 6.9, …</code></pre>
<pre class="r"><code>glimpse(wahlkreise_shp)
#&gt; Observations: 299
#&gt; Variables: 5
#&gt; $ WKR_NR    &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,…
#&gt; $ LAND_NR   &lt;fct&gt; 01, 01, 01, 01, 01, 01, 01, 01, 01, 01, 01, 13, 13, 13…
#&gt; $ LAND_NAME &lt;fct&gt; Schleswig-Holstein, Schleswig-Holstein, Schleswig-Hols…
#&gt; $ WKR_NAME  &lt;fct&gt; Flensburg – Schleswig, Nordfriesland – Dithmarschen No…
#&gt; $ geometry  &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((543474.9 60..., MULTIPOLY…</code></pre>
<p>Let’s pick only a few columns to make life easier:</p>
<pre class="r"><code>socec_short &lt;- socec %&gt;%  # Spalten wählen und umbenennen
  select(WKR_NAME = V03,
         WKR_NR = V02,
         wegzug = V11, # Wegzugssalde
         migration = V19,  # Migrationsanteil
         auslaender = V08,  # Auslaenderanteil
         alq = V47,  # Arbeitslosenquote
         migration = V19)  # Anteil mit Migrationshintergrund</code></pre>
</div>
<div id="join-datasets" class="section level1">
<h1>Join datasets</h1>
<p>There are two data sets: One for the socioeconomic indicators, one for the maps. Let’s join them.</p>
<pre class="r"><code>socec_shape &lt;- socec_short %&gt;%  # Plotten (Arbeitslosigkeit)
  left_join(wahlkreise_shp)</code></pre>
<p>This step is not strictly needed (I did not do it the book), but it may save some typing.</p>
<p>Now plot it:</p>
<pre class="r"><code>socec_shape %&gt;% 
  ggplot +
   aes(fill = alq) +
   theme_void() +
   geom_sf(aes(geometry = geometry)) 

socec_shape %&gt;% 
  ggplot +
   aes(fill = migration) +
   scale_fill_viridis() +
   theme_void() +
   geom_sf(aes(geometry = geometry)) </code></pre>
<p><img src="/post/2019-07-29-geoplotting-update-to-my-modar-book_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;" /><img src="/post/2019-07-29-geoplotting-update-to-my-modar-book_files/figure-html/unnamed-chunk-5-2.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="what-went-wrong-in-my-book" class="section level1">
<h1>What went wrong in my book?</h1>
<ul>
<li><code>geom_sf()</code> needs to be updated to <code>geom_sf(aes(geometry = geometry))</code>. Apparently, the data column with the geo data is not found automatically anymore. I’m unsure about the causes.</li>
<li>Typo on page 219: after <code>theme_void()</code> there was a <code>+</code> missing</li>
</ul>
</div>
<div id="sessioninfo" class="section level1">
<h1>sessionInfo</h1>
<pre class="r"><code>sessionInfo()
#&gt; R version 3.6.0 (2019-04-26)
#&gt; Platform: x86_64-apple-darwin15.6.0 (64-bit)
#&gt; Running under: macOS Mojave 10.14.5
#&gt; 
#&gt; Matrix products: default
#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
#&gt; 
#&gt; locale:
#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt;  [1] viridis_0.5.1     viridisLite_0.3.0 sf_0.7-6         
#&gt;  [4] forcats_0.4.0     stringr_1.4.0     dplyr_0.8.3      
#&gt;  [7] purrr_0.3.2       readr_1.3.1       tidyr_0.8.3      
#&gt; [10] tibble_2.1.3      ggplot2_3.2.0     tidyverse_1.2.1  
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] tidyselect_0.2.5   xfun_0.8           haven_2.1.1       
#&gt;  [4] lattice_0.20-38    colorspace_1.4-1   generics_0.0.2    
#&gt;  [7] vctrs_0.2.0        htmltools_0.3.6    yaml_2.2.0        
#&gt; [10] rlang_0.4.0        e1071_1.7-2        pillar_1.4.2      
#&gt; [13] glue_1.3.1.9000    withr_2.1.2        DBI_1.0.0         
#&gt; [16] modelr_0.1.4       readxl_1.3.1       munsell_0.5.0     
#&gt; [19] blogdown_0.14      gtable_0.3.0       cellranger_1.1.0  
#&gt; [22] rvest_0.3.4        codetools_0.2-16   evaluate_0.14     
#&gt; [25] labeling_0.3       knitr_1.23         class_7.3-15      
#&gt; [28] broom_0.5.2        Rcpp_1.0.1         KernSmooth_2.23-15
#&gt; [31] classInt_0.3-3     scales_1.0.0       backports_1.1.4   
#&gt; [34] jsonlite_1.6       gridExtra_2.3      hms_0.5.0         
#&gt; [37] digest_0.6.20      stringi_1.4.3      bookdown_0.12     
#&gt; [40] grid_3.6.0         cli_1.1.0          tools_3.6.0       
#&gt; [43] magrittr_1.5       lazyeval_0.2.2     crayon_1.3.4      
#&gt; [46] pkgconfig_2.0.2    zeallot_0.1.0      xml2_1.2.0        
#&gt; [49] lubridate_1.7.4    assertthat_0.2.1   rmarkdown_1.14    
#&gt; [52] httr_1.4.0         rstudioapi_0.10    R6_2.4.0          
#&gt; [55] units_0.6-3        nlme_3.1-140       compiler_3.6.0</code></pre>
</div>

    </div>
  </article>

  
<section id="comments">
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var d = document, s = d.createElement('script');
    s.src = '//https-data-se-netlify-com.disqus.com/embed.js'; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>



</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>


<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.67.0" />


<title>Some ways for plotting 3D linear models - Data Se</title>
<meta property="og:title" content="Some ways for plotting 3D linear models - Data Se">



  








<link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/logo-data-se.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="/">Blog</a></li>
    
    <li><a href="/privacy/">Data privacy</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">4 min read</span>
    

    <h1 class="article-title">Some ways for plotting 3D linear models</h1>

    
    <span class="article-date">2019/10/21</span>
    

    <div class="article-content">
      
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/plotly-binding/plotly.js"></script>
<script src="/rmarkdown-libs/typedarray/typedarray.min.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<link href="/rmarkdown-libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/rmarkdown-libs/plotly-main/plotly-latest.min.js"></script>


<div id="load-packages" class="section level1">
<h1>Load packages</h1>
<pre class="r"><code>library(tidyverse)
library(mosaic)
library(plotly)
library(scatterplot3d)
library(rsm)</code></pre>
</div>
<div id="motivation" class="section level1">
<h1>Motivation</h1>
<p>Linear models are a standard way of predicting or explaining some data. Visualizing data is not only of didactical value but provides heuristical value too, as demonstrated by <a href="https://en.wikipedia.org/wiki/Anscombe%27s_quartet">Anscombe’s Quartet</a>.</p>
<p>Visualizing linear models in 2D is straightforward, but visualizing linear models with more than one predictor is much less so. The aim of this post is to demonstrate some ways do visualize linear models with more than one predictor, using popular R packages. We will focus on 3D examples, that is, two predictors.</p>
</div>
<div id="setup" class="section level1">
<h1>Setup</h1>
<p>Some data</p>
<pre class="r"><code>data(mtcars)</code></pre>
<p>Some packages</p>
<pre class="r"><code>library(tidyverse)
library(mosaic)</code></pre>
</div>
<div id="baseline-model" class="section level1">
<h1>Baseline model</h1>
<p>For the sake of simplicity, let’s start with a 2D model.</p>
<pre class="r"><code>lm0 &lt;- lm(mpg ~ hp, data = mtcars)</code></pre>
<div id="mosaic" class="section level2">
<h2>`mosaic``</h2>
<pre class="r"><code>plotModel(lm0)</code></pre>
<p><img src="/post/2019-10-21-some-ways-for-plotting-3d-linear-models_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggformula" class="section level2">
<h2>`ggformula``</h2>
<pre class="r"><code>gf_point(mpg ~ hp, data = mtcars) %&gt;% 
  gf_lm()</code></pre>
<p><img src="/post/2019-10-21-some-ways-for-plotting-3d-linear-models_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2" class="section level2">
<h2><code>ggplot2</code></h2>
<pre class="r"><code>f0 &lt;- function(x) {coef(lm0)[1] + coef(lm0)[2] * x}

ggplot(mtcars) +
  aes(x = hp, y = mpg) +
  geom_point() +
  stat_function(fun = f0)</code></pre>
<p><img src="/post/2019-10-21-some-ways-for-plotting-3d-linear-models_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="makefun" class="section level2">
<h2><code>makeFun</code></h2>
<p>Extracting the function itself from a linear model can be achieved like this:</p>
<pre class="r"><code>f0 &lt;- makeFun(lm0)
f0
#&gt; function (hp, ..., transformation = function (x) 
#&gt; x) 
#&gt; return(transformation(predict(model, newdata = data.frame(hp = hp), 
#&gt;     ...)))
#&gt; &lt;environment: 0x7feb7b4f3200&gt;
#&gt; attr(,&quot;coefficients&quot;)
#&gt; (Intercept)          hp 
#&gt; 30.09886054 -0.06822828</code></pre>
<p>Then again:</p>
<pre class="r"><code>ggplot(mtcars) +
  aes(x = hp, y = mpg) +
  geom_point() +
  stat_function(fun = f0)</code></pre>
<p><img src="/post/2019-10-21-some-ways-for-plotting-3d-linear-models_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="our-initial-linear-model-for-3d" class="section level1">
<h1>Our (initial) linear model for 3D</h1>
<pre class="r"><code>lm1 &lt;- lm(mpg ~ hp * disp, data = mtcars)</code></pre>
<p>Note that this notation is synonymous to this one:</p>
<pre class="r"><code>lm1 &lt;- lm(mpg ~ hp + disp + hp:disp, data = mtcars)</code></pre>
<div id="gf_function_2d" class="section level2">
<h2><code>gf_function_2d()</code></h2>
<p>Let’s briefly check the range of the predictors:</p>
<pre class="r"><code>preds &lt;- c(&quot;hp&quot;, &quot;disp&quot;)</code></pre>
<pre class="r"><code>mtcars %&gt;% 
  dplyr::select(one_of(preds)) %&gt;% 
  summarise_all(funs(min, max))
#&gt;   hp_min disp_min hp_max disp_max
#&gt; 1     52     71.1    335      472</code></pre>
<p>We’ll use this information to gauge the limits of the following graph:</p>
<pre class="r"><code>f1 &lt;- makeFun(lm1)

p1 &lt;- gf_function_2d(f1, xlim = c(50, 300), ylim = c(50, 500)) %&gt;% 
  gf_labs(x = &quot;hp&quot;, y = &quot;disp&quot;) %&gt;% 
  gf_refine(scale_fill_viridis_c())
p1</code></pre>
<p><img src="/post/2019-10-21-some-ways-for-plotting-3d-linear-models_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="computing-a-grid-and-plotting-it" class="section level2">
<h2>Computing a grid and plotting it</h2>
<p>First we devise seom combinations of hp and disp values. Then we predict the <code>mpg</code> values based on those values using <code>lm1</code>.</p>
<pre class="r"><code>hp_disp_grid &lt;- expand_grid(hp = seq(50, 300, by = 10), disp = seq(50, 500, by= 10))


grid2 &lt;- hp_disp_grid %&gt;% 
  mutate(mpg_pred_lm1 = predict(lm1, newdata = data.frame(hp, disp)))</code></pre>
<p>Check</p>
<pre class="r"><code>gf_density(~mpg_pred_lm1, data = grid2)</code></pre>
<p><img src="/post/2019-10-21-some-ways-for-plotting-3d-linear-models_files/figure-html/unnamed-chunk-15-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Now add the predicted value to the <code>mtcars</code> dataframe too:</p>
<pre class="r"><code>mtcars &lt;- mtcars %&gt;% 
  mutate(pred_lm1 = predict(lm1))</code></pre>
<pre class="r"><code>ggplot(aes(x = hp, y = disp), data = grid2) +
  geom_raster(aes(fill = mpg_pred_lm1)) +
  scale_fill_viridis_c() +
  geom_point(data = mtcars, aes(color = pred_lm1)) +
  scale_color_viridis_c()</code></pre>
<p><img src="/post/2019-10-21-some-ways-for-plotting-3d-linear-models_files/figure-html/unnamed-chunk-17-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="plotfun-as-tile-plot-heatmap" class="section level2">
<h2><code>plotFun</code> as tile plot (heatmap)</h2>
<p>mosaic provides a convenient function to plot linear models with predictors, <code>plotFun()</code>.</p>
<pre class="r"><code>plotFun(f1(hp, disp) ~ hp &amp; disp)</code></pre>
<p><img src="/post/2019-10-21-some-ways-for-plotting-3d-linear-models_files/figure-html/unnamed-chunk-18-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="plotfun-as-3d-surface-plot" class="section level2">
<h2><code>plotFun</code> as 3d surface plot</h2>
<pre class="r"><code>plotFun(f1(hp, disp) ~ hp &amp; disp, surface = TRUE)</code></pre>
<p><img src="/post/2019-10-21-some-ways-for-plotting-3d-linear-models_files/figure-html/unnamed-chunk-19-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="plotly-surface" class="section level2">
<h2>Plotly surface</h2>
<p>For plotly surface, we need the data in <em>wide</em> format, ie., we need to spread them out, from long (tidy, standard) format to the wide format. In addition, there should be no more name (key) column, and it ought to be a matrix:</p>
<pre class="r"><code>grid_wide &lt;- grid2 %&gt;% 
  pivot_wider(names_from = disp, values_from = mpg_pred_lm1) %&gt;% 
  select(-1) %&gt;% 
  as.matrix


rownames(grid_wide) &lt;- seq(50, 300, by = 10)</code></pre>
<pre class="r"><code>xaxis &lt;- list(
  title = &quot;hp&quot;
  #range = c(50, 300)
)

yaxis &lt;- list(
  title = &quot;disp&quot;
  #range = c(50, 500)
)

zaxis &lt;- list(
  title = &quot;mpg&quot;
  #range = c(10, 30)
)

p &lt;- plot_ly(z = ~grid_wide, 
             x = seq(50, 300, by = 10),
             y = seq(50, 500, by = 10)) %&gt;% 
  add_surface(
  contours = list(
    z = list(
      show=TRUE,
      usecolormap=TRUE,
      highlightcolor=&quot;#ff0000&quot;
      #project=list(z=TRUE)
      )
    )
  ) %&gt;%
    layout(
    title = &quot;lm1 as 3d plane&quot;,
    scene = list(
      xaxis = xaxis,
      yaxis = yaxis,
      zaxis = zaxis
    ))

p</code></pre>
<div id="htmlwidget-1" style="width:70%;height:355.968px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"visdat":{"3b791d79a9da":["function () ","plotlyVisDat"]},"cur_data":"3b791d79a9da","attrs":{"3b791d79a9da":{"z":{},"x":[50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300],"y":[50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340,350,360,370,380,390,400,410,420,430,440,450,460,470,480,490,500],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"surface","contours":{"z":{"show":true,"usecolormap":true,"highlightcolor":"#ff0000"}},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"lm1 as 3d plane","scene":{"xaxis":{"title":"hp"},"yaxis":{"title":"disp"},"zaxis":{"title":"mpg"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"showSendToCloud":false},"data":[{"colorbar":{"title":"grid_wide","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333334","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"z":[[31.8360228286082,31.2473172531058,30.6586116776035,30.0699061021011,29.4812005265988,28.8924949510964,28.3037893755941,27.7150838000917,27.1263782245893,26.537672649087,25.9489670735846,25.3602614980823,24.7715559225799,24.1828503470776,23.5941447715752,23.0054391960729,22.4167336205705,21.8280280450682,21.2393224695658,20.6506168940635,20.0619113185611,19.4732057430588,18.8845001675564,18.2957945920541,17.7070890165517,17.1183834410493,16.529677865547,15.9409722900446,15.3522667145423,14.7635611390399,14.1748555635376,13.5861499880352,12.9974444125329,12.4087388370305,11.8200332615282,11.2313276860258,10.6426221105235,10.0539165350211,9.46521095951876,8.87650538401641,8.28779980851406,7.6990942330117,7.11038865750935,6.521683082007,5.93297750650465,5.34427193100229],[31.0021050846112,30.4424044621226,29.882703839634,29.3230032171454,28.7633025946567,28.2036019721681,27.6439013496795,27.0842007271909,26.5245001047022,25.9647994822136,25.405098859725,24.8453982372364,24.2856976147477,23.7259969922591,23.1662963697705,22.6065957472819,22.0468951247933,21.4871945023046,20.927493879816,20.3677932573274,19.8080926348388,19.2483920123501,18.6886913898615,18.1289907673729,17.5692901448843,17.0095895223956,16.449888899907,15.8901882774184,15.3304876549298,14.7707870324412,14.2110864099525,13.6513857874639,13.0916851649753,12.5319845424867,11.972283919998,11.4125832975094,10.8528826750208,10.2931820525322,9.73348143004354,9.17378080755492,8.6140801850663,8.05437956257767,7.49467894008905,6.93497831760043,6.3752776951118,5.81557707262317],[30.1681873406143,29.6374916711394,29.1067960016645,28.5761003321896,28.0454046627147,27.5147089932398,26.9840133237649,26.45331765429,25.9226219848151,25.3919263153402,24.8612306458654,24.3305349763905,23.7998393069156,23.2691436374407,22.7384479679658,22.2077522984909,21.677056629016,21.1463609595411,20.6156652900662,20.0849696205913,19.5542739511164,19.0235782816415,18.4928826121666,17.9621869426917,17.4314912732168,16.9007956037419,16.3700999342671,15.8394042647922,15.3087085953173,14.7780129258424,14.2473172563675,13.7166215868926,13.1859259174177,12.6552302479428,12.1245345784679,11.593838908993,11.0631432395181,10.5324475700432,10.0017519005683,9.47105623109343,8.94036056161854,8.40966489214365,7.87896922266876,7.34827355319386,6.81757788371897,6.28688221424407],[29.3342695966174,28.8325788801562,28.330888163695,27.8291974472339,27.3275067307727,26.8258160143115,26.3241252978504,25.8224345813892,25.320743864928,24.8190531484669,24.3173624320057,23.8156717155445,23.3139809990834,22.8122902826222,22.3105995661611,21.8089088496999,21.3072181332387,20.8055274167776,20.3038367003164,19.8021459838552,19.3004552673941,18.7987645509329,18.2970738344717,17.7953831180106,17.2936924015494,16.7920016850882,16.2903109686271,15.7886202521659,15.2869295357048,14.7852388192436,14.2835481027824,13.7818573863213,13.2801666698601,12.7784759533989,12.2767852369378,11.7750945204766,11.2734038040154,10.7717130875543,10.2700223710931,9.76833165463195,9.26664093817078,8.76495022170962,8.26325950524845,7.76156878878729,7.25987807232613,6.75818735586495],[28.5003518526204,28.027666089173,27.5549803257255,27.0822945622781,26.6096087988307,26.1369230353832,25.6642372719358,25.1915515084884,24.7188657450409,24.2461799815935,23.7734942181461,23.3008084546986,22.8281226912512,22.3554369278038,21.8827511643563,21.4100654009089,20.9373796374615,20.464693874014,19.9920081105666,19.5193223471192,19.0466365836717,18.5739508202243,18.1012650567768,17.6285792933294,17.155893529882,16.6832077664345,16.2105220029871,15.7378362395397,15.2651504760922,14.7924647126448,14.3197789491974,13.8470931857499,13.3744074223025,12.9017216588551,12.4290358954076,11.9563501319602,11.4836643685128,11.0109786050653,10.5382928416179,10.0656070781705,9.59292131472302,9.12023555127559,8.64754978782815,8.17486402438072,7.70217826093328,7.22949249748584],[27.6664341086235,27.2227532981898,26.7790724877561,26.3353916773224,25.8917108668886,25.4480300564549,25.0043492460212,24.5606684355875,24.1169876251538,23.6733068147201,23.2296260042864,22.7859451938527,22.342264383419,21.8985835729853,21.4549027625516,21.0112219521179,20.5675411416842,20.1238603312505,19.6801795208168,19.2364987103831,18.7928178999494,18.3491370895157,17.905456279082,17.4617754686482,17.0180946582145,16.5744138477808,16.1307330373471,15.6870522269134,15.2433714164797,14.799690606046,14.3560097956123,13.9123289851786,13.4686481747449,13.0249673643112,12.5812865538775,12.1376057434438,11.6939249330101,11.2502441225764,10.8065633121427,10.362882501709,9.91920169127526,9.47552088084156,9.03184007040785,8.58815925997415,8.14447844954044,7.70079763910673],[26.8325163646265,26.4178405072066,26.0031646497866,25.5884887923666,25.1738129349466,24.7591370775266,24.3444612201067,23.9297853626867,23.5151095052667,23.1004336478467,22.6857577904268,22.2710819330068,21.8564060755868,21.4417302181668,21.0270543607469,20.6123785033269,20.1977026459069,19.7830267884869,19.368350931067,18.953675073647,18.538999216227,18.124323358807,17.7096475013871,17.2949716439671,16.8802957865471,16.4656199291271,16.0509440717072,15.6362682142872,15.2215923568672,14.8069164994472,14.3922406420273,13.9775647846073,13.5628889271873,13.1482130697673,12.7335372123474,12.3188613549274,11.9041854975074,11.4895096400874,11.0748337826675,10.6601579252475,10.2454820678275,9.83080621040753,9.41613035298755,9.00145449556758,8.5867786381476,8.17210278072762],[25.9985986206296,25.6129277162233,25.2272568118171,24.8415859074108,24.4559150030046,24.0702440985984,23.6845731941921,23.2989022897859,22.9132313853796,22.5275604809734,22.1418895765671,21.7562186721609,21.3705477677546,20.9848768633484,20.5992059589421,20.2135350545359,19.8278641501296,19.4421932457234,19.0565223413172,18.6708514369109,18.2851805325047,17.8995096280984,17.5138387236922,17.1281678192859,16.7424969148797,16.3568260104734,15.9711551060672,15.5854842016609,15.1998132972547,14.8141423928484,14.4284714884422,14.042800584036,13.6571296796297,13.2714587752235,12.8857878708172,12.500116966411,12.1144460620047,11.7287751575985,11.3431042531922,10.957433348786,10.5717624443797,10.1860915399735,9.80042063556725,9.41474973116101,9.02907882675476,8.6434079223485],[25.1646808766326,24.8080149252401,24.4513489738476,24.0946830224551,23.7380170710626,23.3813511196701,23.0246851682775,22.668019216885,22.3113532654925,21.9546873141,21.5980213627075,21.241355411315,20.8846894599224,20.5280235085299,20.1713575571374,19.8146916057449,19.4580256543524,19.1013597029599,18.7446937515673,18.3880278001748,18.0313618487823,17.6746958973898,17.3180299459973,16.9613639946048,16.6046980432122,16.2480320918197,15.8913661404272,15.5347001890347,15.1780342376422,14.8213682862497,14.4647023348571,14.1080363834646,13.7513704320721,13.3947044806796,13.0380385292871,12.6813725778946,12.324706626502,11.9680406751095,11.611374723717,11.2547087723245,10.898042820932,10.5413768695395,10.1847109181469,9.82804496675443,9.47137901536192,9.11471306396939],[24.3307631326357,24.0031021342569,23.6754411358781,23.3477801374993,23.0201191391206,22.6924581407418,22.364797142363,22.0371361439842,21.7094751456054,21.3818141472266,21.0541531488478,20.726492150469,20.3988311520903,20.0711701537115,19.7435091553327,19.4158481569539,19.0881871585751,18.7605261601963,18.4328651618175,18.1052041634387,17.77754316506,17.4498821666812,17.1222211683024,16.7945601699236,16.4668991715448,16.139238173166,15.8115771747872,15.4839161764085,15.1562551780297,14.8285941796509,14.5009331812721,14.1732721828933,13.8456111845145,13.5179501861357,13.1902891877569,12.8626281893782,12.5349671909994,12.2073061926206,11.8796451942418,11.551984195863,11.2243231974842,10.8966621991054,10.5690012007266,10.2413402023479,9.91367920396907,9.58601820559028],[23.4968453886388,23.1981893432737,22.8995332979086,22.6008772525436,22.3022212071785,22.0035651618135,21.7049091164484,21.4062530710834,21.1075970257183,20.8089409803532,20.5102849349882,20.2116288896231,19.9129728442581,19.614316798893,19.315660753528,19.0170047081629,18.7183486627978,18.4196926174328,18.1210365720677,17.8223805267027,17.5237244813376,17.2250684359726,16.9264123906075,16.6277563452424,16.3291002998774,16.0304442545123,15.7317882091473,15.4331321637822,15.1344761184172,14.8358200730521,14.537164027687,14.238507982322,13.9398519369569,13.6411958915919,13.3425398462268,13.0438838008617,12.7452277554967,12.4465717101316,12.1479156647666,11.8492596194015,11.5506035740365,11.2519475286714,10.9532914833064,10.6546354379413,10.3559793925762,10.0573233472112],[22.6629276446418,22.3932765522905,22.1236254599392,21.8539743675878,21.5843232752365,21.3146721828852,21.0450210905339,20.7753699981825,20.5057189058312,20.2360678134799,19.9664167211285,19.6967656287772,19.4271145364259,19.1574634440746,18.8878123517232,18.6181612593719,18.3485101670206,18.0788590746692,17.8092079823179,17.5395568899666,17.2699057976153,17.0002547052639,16.7306036129126,16.4609525205613,16.1913014282099,15.9216503358586,15.6519992435073,15.382348151156,15.1126970588046,14.8430459664533,14.573394874102,14.3037437817507,14.0340926893993,13.764441597048,13.4947905046967,13.2251394123453,12.955488319994,12.6858372276427,12.4161861352914,12.14653504294,11.8768839505887,11.6072328582374,11.337581765886,11.0679306735347,10.7982795811834,10.5286284888321],[21.8290099006449,21.5883637613073,21.3477176219697,21.1070714826321,20.8664253432945,20.6257792039569,20.3851330646193,20.1444869252817,19.9038407859441,19.6631946466065,19.4225485072689,19.1819023679313,18.9412562285937,18.7006100892561,18.4599639499185,18.2193178105809,17.9786716712433,17.7380255319057,17.4973793925681,17.2567332532305,17.0160871138929,16.7754409745553,16.5347948352177,16.2941486958801,16.0535025565425,15.8128564172049,15.5722102778673,15.3315641385297,15.0909179991921,14.8502718598545,14.6096257205169,14.3689795811793,14.1283334418417,13.8876873025041,13.6470411631665,13.4063950238289,13.1657488844913,12.9251027451537,12.6844566058161,12.4438104664785,12.2031643271409,11.9625181878033,11.7218720484657,11.4812259091282,11.2405797697906,10.9999336304529],[20.9950921566479,20.7834509703241,20.5718097840002,20.3601685976763,20.1485274113525,19.9368862250286,19.7252450387047,19.5136038523809,19.301962666057,19.0903214797331,18.8786802934092,18.6670391070854,18.4553979207615,18.2437567344376,18.0321155481138,17.8204743617899,17.608833175466,17.3971919891422,17.1855508028183,16.9739096164944,16.7622684301706,16.5506272438467,16.3389860575228,16.127344871199,15.9157036848751,15.7040624985512,15.4924213122273,15.2807801259035,15.0691389395796,14.8574977532557,14.6458565669319,14.434215380608,14.2225741942841,14.0109330079603,13.7992918216364,13.5876506353125,13.3760094489887,13.1643682626648,12.9527270763409,12.7410858900171,12.5294447036932,12.3178035173693,12.1061623310454,11.8945211447216,11.6828799583977,11.4712387720738],[20.161174412651,19.9785381793409,19.7959019460307,19.6132657127206,19.4306294794104,19.2479932461003,19.0653570127902,18.88272077948,18.7000845461699,18.5174483128597,18.3348120795496,18.1521758462395,17.9695396129293,17.7869033796192,17.604267146309,17.4216309129989,17.2389946796888,17.0563584463786,16.8737222130685,16.6910859797584,16.5084497464482,16.3258135131381,16.1431772798279,15.9605410465178,15.7779048132077,15.5952685798975,15.4126323465874,15.2299961132772,15.0473598799671,14.864723646657,14.6820874133468,14.4994511800367,14.3168149467265,14.1341787134164,13.9515424801063,13.7689062467961,13.586270013486,13.4036337801758,13.2209975468657,13.0383613135556,12.8557250802454,12.6730888469353,12.4904526136252,12.307816380315,12.1251801470049,11.9425439136947],[19.3272566686541,19.1736253883576,19.0199941080612,18.8663628277648,18.7127315474684,18.559100267172,18.4054689868756,18.2518377065792,18.0982064262828,17.9445751459864,17.79094386569,17.6373125853935,17.4836813050971,17.3300500248007,17.1764187445043,17.0227874642079,16.8691561839115,16.7155249036151,16.5618936233187,16.4082623430223,16.2546310627259,16.1009997824294,15.947368502133,15.7937372218366,15.6401059415402,15.4864746612438,15.3328433809474,15.179212100651,15.0255808203546,14.8719495400582,14.7183182597618,14.5646869794654,14.4110556991689,14.2574244188725,14.1037931385761,13.9501618582797,13.7965305779833,13.6428992976869,13.4892680173905,13.3356367370941,13.1820054567977,13.0283741765013,12.8747428962049,12.7211116159084,12.567480335612,12.4138490553156],[18.4933389246571,18.3687125973744,18.2440862700918,18.1194599428091,17.9948336155264,17.8702072882437,17.745580960961,17.6209546336784,17.4963283063957,17.371701979113,17.2470756518303,17.1224493245476,16.997822997265,16.8731966699823,16.7485703426996,16.6239440154169,16.4993176881342,16.3746913608515,16.2500650335689,16.1254387062862,16.0008123790035,15.8761860517208,15.7515597244381,15.6269333971555,15.5023070698728,15.3776807425901,15.2530544153074,15.1284280880247,15.0038017607421,14.8791754334594,14.7545491061767,14.629922778894,14.5052964516113,14.3806701243287,14.256043797046,14.1314174697633,14.0067911424806,13.8821648151979,13.7575384879153,13.6329121606326,13.5082858333499,13.3836595060672,13.2590331787845,13.1344068515019,13.0097805242192,12.8851541969365],[17.6594211806602,17.5637998063912,17.4681784321223,17.3725570578533,17.2769356835844,17.1813143093154,17.0856929350465,16.9900715607775,16.8944501865086,16.7988288122396,16.7032074379707,16.6075860637017,16.5119646894328,16.4163433151638,16.3207219408949,16.2251005666259,16.129479192357,16.033857818088,15.9382364438191,15.8426150695501,15.7469936952812,15.6513723210122,15.5557509467433,15.4601295724743,15.3645081982054,15.2688868239364,15.1732654496675,15.0776440753985,14.9820227011296,14.8864013268606,14.7907799525917,14.6951585783227,14.5995372040537,14.5039158297848,14.4082944555159,14.3126730812469,14.2170517069779,14.121430332709,14.02580895844,13.9301875841711,13.8345662099021,13.7389448356332,13.6433234613642,13.5477020870953,13.4520807128263,13.3564593385574],[16.8255034366632,16.758887015408,16.6922705941528,16.6256541728976,16.5590377516423,16.4924213303871,16.4258049091319,16.3591884878767,16.2925720666215,16.2259556453662,16.159339224111,16.0927228028558,16.0261063816006,15.9594899603454,15.8928735390901,15.8262571178349,15.7596406965797,15.6930242753245,15.6264078540693,15.559791432814,15.4931750115588,15.4265585903036,15.3599421690484,15.2933257477931,15.2267093265379,15.1600929052827,15.0934764840275,15.0268600627723,14.960243641517,14.8936272202618,14.8270107990066,14.7603943777514,14.6937779564962,14.6271615352409,14.5605451139857,14.4939286927305,14.4273122714753,14.3606958502201,14.2940794289648,14.2274630077096,14.1608465864544,14.0942301651992,14.0276137439439,13.9609973226887,13.8943809014335,13.8277644801783],[15.9915856926663,15.9539742244248,15.9163627561833,15.8787512879418,15.8411398197003,15.8035283514588,15.7659168832173,15.7283054149758,15.6906939467344,15.6530824784929,15.6154710102514,15.5778595420099,15.5402480737684,15.5026366055269,15.4650251372854,15.4274136690439,15.3898022008024,15.3521907325609,15.3145792643194,15.276967796078,15.2393563278365,15.201744859595,15.1641333913535,15.126521923112,15.0889104548705,15.051298986629,15.0136875183875,14.976076050146,14.9384645819045,14.900853113663,14.8632416454215,14.82563017718,14.7880187089386,14.7504072406971,14.7127957724556,14.6751843042141,14.6375728359726,14.5999613677311,14.5623498994896,14.5247384312481,14.4871269630066,14.4495154947651,14.4119040265236,14.3742925582822,14.3366810900407,14.2990696217992],[15.1576679486693,15.1490614334416,15.1404549182138,15.1318484029861,15.1232418877583,15.1146353725305,15.1060288573028,15.097422342075,15.0888158268473,15.0802093116195,15.0716027963917,15.062996281164,15.0543897659362,15.0457832507084,15.0371767354807,15.0285702202529,15.0199637050252,15.0113571897974,15.0027506745696,14.9941441593419,14.9855376441141,14.9769311288863,14.9683246136586,14.9597180984308,14.9511115832031,14.9425050679753,14.9338985527475,14.9252920375198,14.916685522292,14.9080790070643,14.8994724918365,14.8908659766087,14.882259461381,14.8736529461532,14.8650464309254,14.8564399156977,14.8478334004699,14.8392268852422,14.8306203700144,14.8220138547866,14.8134073395589,14.8048008243311,14.7961943091033,14.7875877938756,14.7789812786478,14.7703747634201],[14.3237502046724,14.3441486424584,14.3645470802443,14.3849455180303,14.4053439558163,14.4257423936022,14.4461408313882,14.4665392691742,14.4869377069601,14.5073361447461,14.5277345825321,14.5481330203181,14.568531458104,14.58892989589,14.609328333676,14.6297267714619,14.6501252092479,14.6705236470339,14.6909220848198,14.7113205226058,14.7317189603918,14.7521173981777,14.7725158359637,14.7929142737497,14.8133127115356,14.8337111493216,14.8541095871076,14.8745080248935,14.8949064626795,14.9153049004655,14.9357033382514,14.9561017760374,14.9765002138234,14.9968986516093,15.0172970893953,15.0376955271813,15.0580939649672,15.0784924027532,15.0988908405392,15.1192892783251,15.1396877161111,15.1600861538971,15.180484591683,15.200883029469,15.221281467255,15.2416799050409],[13.4898324606755,13.5392358514752,13.5886392422749,13.6380426330746,13.6874460238743,13.736849414674,13.7862528054736,13.8356561962733,13.885059587073,13.9344629778727,13.9838663686724,14.0332697594721,14.0826731502718,14.1320765410715,14.1814799318712,14.2308833226709,14.2802867134706,14.3296901042703,14.37909349507,14.4284968858697,14.4779002766694,14.5273036674691,14.5767070582688,14.6261104490685,14.6755138398682,14.7249172306679,14.7743206214676,14.8237240122673,14.873127403067,14.9225307938667,14.9719341846664,15.0213375754661,15.0707409662658,15.1201443570655,15.1695477478652,15.2189511386649,15.2683545294646,15.3177579202643,15.367161311064,15.4165647018637,15.4659680926633,15.515371483463,15.5647748742627,15.6141782650624,15.6635816558621,15.7129850466618],[12.6559147166785,12.7343230604919,12.8127314043054,12.8911397481188,12.9695480919322,13.0479564357457,13.1263647795591,13.2047731233725,13.2831814671859,13.3615898109994,13.4399981548128,13.5184064986262,13.5968148424396,13.6752231862531,13.7536315300665,13.8320398738799,13.9104482176934,13.9888565615068,14.0672649053202,14.1456732491336,14.2240815929471,14.3024899367605,14.3808982805739,14.4593066243873,14.5377149682008,14.6161233120142,14.6945316558276,14.772939999641,14.8513483434545,14.9297566872679,15.0081650310813,15.0865733748947,15.1649817187082,15.2433900625216,15.321798406335,15.4002067501485,15.4786150939619,15.5570234377753,15.6354317815887,15.7138401254022,15.7922484692156,15.870656813029,15.9490651568424,16.0274735006559,16.1058818444693,16.1842901882827],[11.8219969726816,11.9294102695087,12.0368235663359,12.144236863163,12.2516501599902,12.3590634568174,12.4664767536445,12.5738900504717,12.6813033472988,12.788716644126,12.8961299409531,13.0035432377803,13.1109565346075,13.2183698314346,13.3257831282618,13.4331964250889,13.5406097219161,13.6480230187432,13.7554363155704,13.8628496123976,13.9702629092247,14.0776762060519,14.185089502879,14.2925027997062,14.3999160965333,14.5073293933605,14.6147426901876,14.7221559870148,14.829569283842,14.9369825806691,15.0443958774963,15.1518091743234,15.2592224711506,15.3666357679777,15.4740490648049,15.581462361632,15.6888756584592,15.7962889552864,15.9037022521135,16.0111155489407,16.1185288457678,16.225942142595,16.3333554394221,16.4407687362493,16.5481820330765,16.6555953299036],[10.9880792286846,11.1244974785255,11.2609157283664,11.3973339782073,11.5337522280482,11.6701704778891,11.80658872773,11.9430069775708,12.0794252274117,12.2158434772526,12.3522617270935,12.4886799769344,12.6250982267753,12.7615164766162,12.897934726457,13.0343529762979,13.1707712261388,13.3071894759797,13.4436077258206,13.5800259756615,13.7164442255024,13.8528624753432,13.9892807251841,14.125698975025,14.2621172248659,14.3985354747068,14.5349537245477,14.6713719743886,14.8077902242294,14.9442084740703,15.0806267239112,15.2170449737521,15.353463223593,15.4898814734339,15.6262997232748,15.7627179731156,15.8991362229565,16.0355544727974,16.1719727226383,16.3083909724792,16.4448092223201,16.581227472161,16.7176457220018,16.8540639718427,16.9904822216836,17.1269004715245]],"x":[50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300],"y":[50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300,310,320,330,340,350,360,370,380,390,400,410,420,430,440,450,460,470,480,490,500],"type":"surface","contours":{"z":{"show":true,"usecolormap":true,"highlightcolor":"#ff0000"}},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="persp" class="section level2">
<h2><code>persp()</code></h2>
<pre class="r"><code>x &lt;- seq(min(mtcars$hp), max(mtcars$hp), length.out = 25)
y &lt;- seq(min(mtcars$disp), max(mtcars$disp), length.out = 25)
z &lt;- outer(x, y, function(x,y) {predict(lm1, data.frame(hp = x, disp = y))})
persp(x,y,z , theta = c(45, 135, 225, 315), col = &quot;lightblue&quot;)</code></pre>
<p><img src="/post/2019-10-21-some-ways-for-plotting-3d-linear-models_files/figure-html/unnamed-chunk-22-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="contour" class="section level2">
<h2><code>contour()</code></h2>
<p>From package <code>rsm</code> we can make use of <code>contour()</code>:</p>
<pre class="r"><code>contour(lm1, hp ~ disp, image = TRUE)
contour(lm1, hp ~ disp, image = FALSE)</code></pre>
<p><img src="/post/2019-10-21-some-ways-for-plotting-3d-linear-models_files/figure-html/unnamed-chunk-23-1.png" width="70%" style="display: block; margin: auto;" /><img src="/post/2019-10-21-some-ways-for-plotting-3d-linear-models_files/figure-html/unnamed-chunk-23-2.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="scatterplot-3d" class="section level2">
<h2>Scatterplot 3d</h2>
<p>First plot the scatterplot:</p>
<pre class="r"><code>d &lt;- mtcars %&gt;% 
  select(hp, disp, mpg)
lm1a &lt;- lm(d$mpg ~ d$hp + d$disp)



p3 &lt;- scatterplot3d(d)
</code></pre>
<p><img src="/post/2019-10-21-some-ways-for-plotting-3d-linear-models_files/figure-html/unnamed-chunk-24-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Now add the regression plane:</p>
<pre class="r"><code>p3$plane3d(lm1a)
#&gt; Error in segments(x, z1, x + y.max * yx.f, z2 + yz.f * y.max, lty = ltya, : plot.new has not been called yet</code></pre>
<p>For some reason, this code does not run in (my) rmarkdown setup, but it worked (on my machine) in a ordinary R script.</p>
</div>
</div>

    </div>
  </article>

  
<section id="comments">
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var d = document, s = d.createElement('script');
    s.src = '//https-data-se-netlify-com.disqus.com/embed.js'; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>



</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>


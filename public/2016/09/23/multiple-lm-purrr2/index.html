<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.77.0" />


<title>Running multiple simple regressions with purrr - Data Se</title>
<meta property="og:title" content="Running multiple simple regressions with purrr - Data Se">



  








<link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/logo-data-se.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="/">Blog</a></li>
    
    <li><a href="/privacy/">Data privacy</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">4 min read</span>
    

    <h1 class="article-title">Running multiple simple regressions with purrr</h1>

    
    <span class="article-date">2016/09/23</span>
    

    <div class="article-content">
      <p>Hadley Wickham&rsquo;s <code>purrr</code> has given a new look at handling data structures to the typical R user (some reasoning suggests that average users don&rsquo;t exist, but that&rsquo;s a different story).</p>
<p>I just tried the following with purrr:</p>
<ul>
<li>Meditate about the running a simple regression, FWIW</li>
<li>Take a dataframe with candidate predictors and an outcome</li>
<li>Throw one predictor at a time into the regression, where the outcome variable remains the same (i.,e multiple simple regressions (one predictor) where the predictor is changed at each run but the outcome remains the same)</li>
<li>tidy up the resulting $$ R^2 $$ in some nice format.</li>
</ul>
<p>I found that <code>purrr</code> does the job nicely, and it&rsquo;s quite instructive, I think. That&rsquo;s why I wrote it up in this short post:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(purrr)  
<span style="color:#a6e22e">library</span>(ggplot2)
<span style="color:#a6e22e">library</span>(dplyr)
<span style="color:#a6e22e">library</span>(broom)
<span style="color:#a6e22e">library</span>(knitr)  <span style="color:#75715e"># for kable</span>
<span style="color:#a6e22e">data</span>(Fair, package <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Ecdat&#34;</span>) <span style="color:#75715e"># extramarital affairs dataset</span>
<span style="color:#a6e22e">glimpse</span>(Fair)
</code></pre></div><pre><code>## Observations: 601
## Variables: 9
## $ sex        &lt;fctr&gt; male, female, female, male, male, female, female, ...
## $ age        &lt;dbl&gt; 37, 27, 32, 57, 22, 32, 22, 57, 32, 22, 37, 27, 47,...
## $ ym         &lt;dbl&gt; 10.00, 4.00, 15.00, 15.00, 0.75, 1.50, 0.75, 15.00,...
## $ child      &lt;fctr&gt; no, no, yes, yes, no, no, no, yes, yes, no, yes, y...
## $ religious  &lt;int&gt; 3, 4, 1, 5, 2, 2, 2, 2, 4, 4, 2, 4, 5, 2, 4, 1, 2, ...
## $ education  &lt;dbl&gt; 18, 14, 12, 18, 17, 17, 12, 14, 16, 14, 20, 18, 17,...
## $ occupation &lt;int&gt; 7, 6, 1, 6, 6, 5, 1, 4, 1, 4, 7, 6, 6, 5, 5, 5, 4, ...
## $ rate       &lt;int&gt; 4, 4, 4, 5, 3, 5, 3, 4, 2, 5, 2, 4, 4, 4, 4, 5, 3, ...
## $ nbaffairs  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">Fair <span style="color:#f92672">%&gt;%</span> 
  dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">select</span>(<span style="color:#f92672">-</span>nbaffairs) <span style="color:#f92672">%&gt;%</span>  <span style="color:#75715e"># exclude outcome, leave only predictors </span>
  <span style="color:#a6e22e">map</span>(<span style="color:#f92672">~</span><span style="color:#a6e22e">lm</span>(Fair<span style="color:#f92672">$</span>nbaffairs <span style="color:#f92672">~</span> .x, data <span style="color:#f92672">=</span> Fair)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">map</span>(summary) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">map_dbl</span>(<span style="color:#e6db74">&#34;r.squared&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  tidy <span style="color:#f92672">%&gt;%</span> 
  dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">arrange</span>(<span style="color:#a6e22e">desc</span>(x)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">rename</span>(r.squared <span style="color:#f92672">=</span> x) <span style="color:#f92672">-&gt;</span> r2s

<span style="color:#a6e22e">kable</span>(r2s)
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">names</th>
<th style="text-align:right">r.squared</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">rate</td>
<td style="text-align:right">0.0781272</td>
</tr>
<tr>
<td style="text-align:left">ym</td>
<td style="text-align:right">0.0349098</td>
</tr>
<tr>
<td style="text-align:left">religious</td>
<td style="text-align:right">0.0208806</td>
</tr>
<tr>
<td style="text-align:left">child</td>
<td style="text-align:right">0.0108181</td>
</tr>
<tr>
<td style="text-align:left">age</td>
<td style="text-align:right">0.0090701</td>
</tr>
<tr>
<td style="text-align:left">occupation</td>
<td style="text-align:right">0.0024613</td>
</tr>
<tr>
<td style="text-align:left">sex</td>
<td style="text-align:right">0.0001377</td>
</tr>
<tr>
<td style="text-align:left">education</td>
<td style="text-align:right">0.0000059</td>
</tr>
</tbody>
</table>
<p>Ok, that appears to be the list of the $$ R^{2} $$ for each simple (one-predictor) regression we have run.</p>
<p>Let&rsquo;s do a quick sense check with the standard way:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">lm1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">lm</span>(nbaffairs <span style="color:#f92672">~</span> rate, data <span style="color:#f92672">=</span> Fair)

<span style="color:#a6e22e">summary</span>(lm1)
</code></pre></div><pre><code>## 
## Call:
## lm(formula = nbaffairs ~ rate, data = Fair)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.9063 -1.3989 -0.5631 -0.5631 11.4369 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   4.7421     0.4790   9.900   &lt;2e-16 ***
## rate         -0.8358     0.1173  -7.125    3e-12 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.17 on 599 degrees of freedom
## Multiple R-squared:  0.07813,	Adjusted R-squared:  0.07659 
## F-statistic: 50.76 on 1 and 599 DF,  p-value: 3.002e-12
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">summary</span>(lm1)<span style="color:#f92672">$</span>r.squared
</code></pre></div><pre><code>## [1] 0.07812718
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">summary</span>(lm1)<span style="color:#f92672">$</span>coefficients[2, <span style="color:#ae81ff">4</span>]  <span style="color:#75715e">#p.value</span>
</code></pre></div><pre><code>## [1] 3.002385e-12
</code></pre><p>Seems to work. To get details of the object <code>summary(lm1)</code>, use <code>str(summary(lm1))</code>.</p>
<p>How many did we run? Just the number of columns minus one (the outcome variable).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">ncol</span>(Fair)<span style="color:#ae81ff">-1</span>
</code></pre></div><pre><code>## [1] 8
</code></pre><p>FWIW, let&rsquo;s plot the resulting values (and sort the predictors by descending values).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">ggplot</span>(r2s, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">reorder</span>(names, r.squared), y <span style="color:#f92672">=</span> r.squared)) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">geom_point</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">ylab</span>(<span style="color:#a6e22e">expression</span>(R^{<span style="color:#ae81ff">2</span>})) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">xlab</span>(<span style="color:#e6db74">&#34;predictors&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;Explained variance per predictor from simple regressions&#34;</span>)
</code></pre></div><!-- raw HTML omitted -->
<p>Wait, one more thing. Suppose we are not only interested in $$ R^{2} $$, but in the p-values (OMG). How to get <em>both</em> values from <code>purrr</code>?.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(magrittr)

Fair <span style="color:#f92672">%&gt;%</span> 
  dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">select</span>(<span style="color:#f92672">-</span>nbaffairs) <span style="color:#f92672">%&gt;%</span>  <span style="color:#75715e"># exclude outcome, leave only predictors </span>
  <span style="color:#a6e22e">map</span>(<span style="color:#f92672">~</span><span style="color:#a6e22e">lm</span>(Fair<span style="color:#f92672">$</span>nbaffairs <span style="color:#f92672">~</span> .x, data <span style="color:#f92672">=</span> Fair)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">map</span>(summary) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;coefficients&#34;</span>)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">map_dbl</span>(<span style="color:#ae81ff">8</span>)  <span style="color:#f92672">%&gt;%</span> <span style="color:#75715e"># 8th element is the p-value </span>
  tidy <span style="color:#f92672">%&gt;%</span> 
  dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">arrange</span>(<span style="color:#a6e22e">desc</span>(x)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">rename</span>(p.value <span style="color:#f92672">=</span> x) <span style="color:#f92672">-&gt;</span> ps
  
  
<span style="color:#a6e22e">kable</span>(ps)
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">names</th>
<th style="text-align:right">p.value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">education</td>
<td style="text-align:right">0.9524501</td>
</tr>
<tr>
<td style="text-align:left">sex</td>
<td style="text-align:right">0.7740138</td>
</tr>
<tr>
<td style="text-align:left">occupation</td>
<td style="text-align:right">0.2245709</td>
</tr>
<tr>
<td style="text-align:left">age</td>
<td style="text-align:right">0.0195320</td>
</tr>
<tr>
<td style="text-align:left">child</td>
<td style="text-align:right">0.0107275</td>
</tr>
<tr>
<td style="text-align:left">religious</td>
<td style="text-align:right">0.0003797</td>
</tr>
<tr>
<td style="text-align:left">ym</td>
<td style="text-align:right">0.0000040</td>
</tr>
<tr>
<td style="text-align:left">rate</td>
<td style="text-align:right">0.0000000</td>
</tr>
</tbody>
</table>
<p>Extracting the p-value by <code>map_dbl(8)</code> is surely far from perfect. Any ideas how to better get the value out of this numeric 2*4 matrix? Thoughts are welcome!</p>

    </div>
  </article>

  
<section id="comments">
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var d = document, s = d.createElement('script');
    s.src = '//https-data-se-netlify-com.disqus.com/embed.js'; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>



</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>


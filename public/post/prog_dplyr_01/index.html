<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Programming with dplyr: Part 01, introduction</title>
  <meta property="og:title" content="Programming with dplyr: Part 01, introduction" />
  <meta name="twitter:title" content="Programming with dplyr: Part 01, introduction" />
  <meta name="description" content="Like for [others], Hadley Wickham&rsquo;s dplyr, and more generally, the tidyverse approach has considerably changed the I do data analyses. Most notably, the pipe (coming from magrittr by Stefan Milton Bache, see here) has creeped into nearly every analyses I, do.
That is, is every analyses except for functions, and other non-interactive stuff. In those programming contexts, the dplyr way does not work, due to its non standard evaluation or NSE for short.">
  <meta property="og:description" content="Like for [others], Hadley Wickham&rsquo;s dplyr, and more generally, the tidyverse approach has considerably changed the I do data analyses. Most notably, the pipe (coming from magrittr by Stefan Milton Bache, see here) has creeped into nearly every analyses I, do.
That is, is every analyses except for functions, and other non-interactive stuff. In those programming contexts, the dplyr way does not work, due to its non standard evaluation or NSE for short.">
  <meta name="twitter:description" content="Like for [others], Hadley Wickham&rsquo;s dplyr, and more generally, the tidyverse approach has considerably changed the I do data analyses. Most notably, the pipe (coming from magrittr by Stefan â€¦">
  <meta name="author" content="Sebastiuan Sauer"/>
  <link href='/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="/img/logo-data-se.png" />
  <meta name="twitter:image" content="/img/logo-data-se.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@sauer_sebasitan" />
  <meta name="twitter:creator" content="@sauer_sebasitan" />
  <meta property="og:url" content="/post/prog_dplyr_01/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Data Se" />

  <meta name="generator" content="Hugo 0.21" />
  <link rel="canonical" href="/post/prog_dplyr_01/" />
  <link rel="alternate" href="" type="application/rss+xml" title="Data Se">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="/css/highlighting.css" />
  <link rel="stylesheet" href="/css/pygment_highlights.css" />
  <link rel="stylesheet" href="/css/highlight.min.css" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-99297878-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Data Se</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/page/about/">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Data Se" href="/">
            <img class="avatar-img" src="/img/logo-data-se.png" alt="Data Se" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>Programming with dplyr: Part 01, introduction</h1>
                
                
                  <span class="post-meta">
  Posted on June 28, 2017
  
</span>


                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>Like for [others], Hadley Wickham&rsquo;s <code>dplyr</code>, and more generally, the <code>tidyverse</code> approach has considerably changed the I do data analyses. Most notably, the pipe (coming from <code>magrittr</code> by Stefan Milton Bache, see <a href="https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html">here</a>) has creeped into nearly every analyses I, do.</p>

<p>That is, is every analyses <em>except for</em> functions, and other non-interactive stuff. In those programming contexts, the dplyr way does not work, due to its <a href="http://adv-r.had.co.nz/Computing-on-the-language.html">non standard evaluation</a> or NSE for short.</p>

<p>So, this post is about <em>programming</em> with dplyr, or more precisely, using the recently introduced <a href="http://dplyr.tidyverse.org/articles/programming.html">tidyeval</a> approach (approached into widely used R libraries, that is).</p>

<p>To understand the usecase, consider the following example. Say, we count the frequencies of some groups, and want to add the proportiong of these counts.</p>

<pre><code class="language-r">library(tidyverse)
</code></pre>

<pre><code class="language-r">mtcars %&gt;% 
  group_by(cyl) %&gt;% 
  summarise(n = n())
</code></pre>

<pre><code>## # A tibble: 3 x 2
##     cyl     n
##   &lt;dbl&gt; &lt;int&gt;
## 1     4    11
## 2     6     7
## 3     8    14
</code></pre>

<p>Or, shorter <code>mtcars %&gt;% count(cyl)</code>.</p>

<p>Now, let&rsquo;s add a column with the proporting of the count column (<code>n</code>).</p>

<pre><code class="language-r">mtcars %&gt;% 
  count(cyl) %&gt;% 
  mutate(prop = n / sum(n))
</code></pre>

<pre><code>## # A tibble: 3 x 3
##     cyl     n    prop
##   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1     4    11 0.34375
## 2     6     7 0.21875
## 3     8    14 0.43750
</code></pre>

<p>For extending this game to more than one variable, see [this post]().</p>

<p>Now, let&rsquo;s assume we would like to put the &lsquo;add a proportion column to my dataframe&rsquo; in a function. How to proceed?</p>

<p>We might think this approach should work:</p>

<pre><code class="language-r">add_prop &lt;- function(df, count_var, group_var){
  df %&gt;% 
    ungroup() %&gt;% 
    group_by(group_var) %&gt;% 
    mutate(prop =  count_var / sum(n()))
}

mtcars %&gt;% 
  count(cyl) %&gt;% 
  add_prop(count_var = n, group_var = cyl)
</code></pre>

<p>However, this does not work.</p>

<p>The dplyr &lsquo;verbs&rsquo; expect <em>quoted</em> input variables. That means we must quote the parameters first, before we can hand over them to dplyr. <code>quo</code> basically means &ldquo;hey R, don&rsquo;t yet evaulate this expression. Just read it, understand the name of the expression, and wait until I tell you. And R, understand, that you got an expression, not a simple text string&rdquo;. The last sentence tells us (or R) that we do not want a text string, but the quotation (or &lsquo;citation&rsquo; of the expression if you like) of an expression to be evaluated in the futre.</p>

<pre><code class="language-r">mtcars %&gt;% 
  count(cyl) %&gt;% 
  add_prop(count_var = quo(n), group_var = quo(cyl))
</code></pre>

<p>The important point is <code>quo</code>.</p>

<pre><code class="language-r">quo(mtcars$cyl)
</code></pre>

<pre><code>## &lt;quosure: global&gt;
## ~mtcars$cyl
</code></pre>

<p>But there&rsquo;s a second step we need to take. Now that <code>quo</code> has defined a quoted expression, the dplyr verbs do not need to quote their input variables, because they are already quoted. That is, we need to tell R now: &ldquo;Hey, do not quote, evaluate! We have taken care of the quoting before&rdquo;.</p>

<pre><code class="language-r">add_prop &lt;- function(df, count_var, group_var){
  df %&gt;% 
    mutate(prop =  (!!count_var) / sum(!!count_var))
}


mtcars %&gt;% 
  count(cyl) %&gt;% 
  add_prop(count_var = quo(n), group_var = quo(cyl)) 
</code></pre>

<pre><code>## # A tibble: 3 x 3
##     cyl     n    prop
##   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
## 1     4    11 0.34375
## 2     6     7 0.21875
## 3     8    14 0.43750
</code></pre>

<p>Hizzah!</p>

      </article>

      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="/../post/extra_prep/" data-toggle="tooltip" data-placement="top" title="Preparation of extraversion survey data">&larr; Previous Post</a>
          </li>
        
        
          <li class="next">
            <a href="/../post/second_look_group_by/" data-toggle="tooltip" data-placement="top" title="A second look to grouping with dplyr">Next Post &rarr;</a>
          </li>
        
      </ul>

      
        
          <div class="disqus-comments">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'https-sebastiansauer-github-io';
    var disqus_identifier = '\/..\/post\/prog_dplyr_01\/';
    var disqus_title = 'Programming with dplyr: Part 01, introduction';
    var disqus_url = '\/..\/post\/prog_dplyr_01\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:ssauer@posteo.de" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/sebastian_sauer" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/sauer_sebasitan" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://reddit.com/u/username" title="Reddit">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-reddit-alien fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/https://www.linkedin.com/in/dr-sebastian-sauer-4791762/" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://www.xing.com/profile/https://www.xing.com/profile/Sebastian_Sauer2" title="Xing">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-xing fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="yourwebsite.com">Sebastiuan Sauer</a>
            
          

          &nbsp;&bull;&nbsp;
          2017

          
            &nbsp;&bull;&nbsp;
            <a href="/">Data Se</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.21</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="/js/main.js"></script>
<script src="/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script><script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js" integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js" integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin="anonymous"></script>
<script src="/js/load-photoswipe.js"></script>



  </body>
</html>


<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.50" />


<title>Convert data frame from &#39;wide&#39; to &#39;long&#39; - Data Se</title>
<meta property="og:title" content="Convert data frame from &#39;wide&#39; to &#39;long&#39; - Data Se">



  








<link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/logo-data-se.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="/">Blog</a></li>
    
    <li><a href="/privacy/">Data privacy</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">6 min read</span>
    

    <h1 class="article-title">Convert data frame from &#39;wide&#39; to &#39;long&#39;</h1>

    
    <span class="article-date">2017/01/06</span>
    

    <div class="article-content">
      

<p>Thanks to my student Marie Halbich who took the pains to collect the data!</p>

<p>At times, your data set will be in &ldquo;wide&rdquo; format, i.e, many columns in comparison to rows. For some analyses however, it is more suitable to have the data in &ldquo;long&rdquo; format. That is, many rows in comparison to columns.</p>

<p>Let&rsquo;s have a look at this data set, for example.</p>

<pre><code class="language-r">d &lt;- read.csv(&quot;https://sebastiansauer.github.io/data/facial_beauty_raw.csv&quot;)

</code></pre>

<p>This is the data from a study tapping into the effect of computerized &ldquo;beautification&rdquo; of some faces on subjective &ldquo;like&rdquo;.</p>

<p>In short, two strawpersons were present either in &ldquo;natural form&rdquo; or &ldquo;beautified&rdquo; with some computer help. Note that the design is a between-group design with the factor &ldquo;strawpersons&rdquo; (A and B) and the factor &ldquo;presentation&rdquo; (natural vs. beautified).</p>

<pre><code class="language-r">library(dplyr)
glimpse(d)
#&gt; Observations: 1,440
#&gt; Variables: 23
#&gt; $ X                                          &lt;int&gt; 1, 2, 3, 4, 5, 6, 7...
#&gt; $ Item                                       &lt;int&gt; 1, 2, 3, 4, 5, 6, 7...
#&gt; $ Alter                                      &lt;int&gt; 26, 31, 35, 34, 31,...
#&gt; $ girl_C_unbearbeitet_Likes                  &lt;int&gt; NA, 1, 1, 1, 1, 1, ...
#&gt; $ girl_C_unbearbeitet_Dislikes               &lt;int&gt; 1, NA, NA, NA, NA, ...
#&gt; $ girl_C_unbearbeitet_Superlikes             &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_C_unbearbeitet_Kontaktaufnahmen       &lt;int&gt; NA, 1, 1, NA, 1, 1,...
#&gt; $ girl_C_unbearbeitet_keine_Kontaktaufnahmen &lt;int&gt; 1, NA, NA, 1, NA, N...
#&gt; $ girl_C_bearbeitet_Like                     &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_C_bearbeitet_Dislike                  &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_C_bearbeitet_Superlike                &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_C_bearbeitet_Kontaktaufnahme          &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_C_bearbeitet_keine_Kontaktaufnahme    &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_A_unbearbeitet_Like                   &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_A_unbearbeitet_Dislike                &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_A_unbearbeitet_Superlike              &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_A_unbearbeitet_Kontaktaufnahme        &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_A_unbearbeitet_keine_Kontaktaufnahme  &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_A_bearbeitet_Like                     &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_A_bearbeitet_Dislike                  &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_A_bearbeitet_Superlike                &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_A_bearbeitet_Kontaktaufnahme          &lt;int&gt; NA, NA, NA, NA, NA,...
#&gt; $ girl_A_bearbeitet_keine_Kontaktaufnahme    &lt;int&gt; NA, NA, NA, NA, NA,...
</code></pre>

<p>On closer inspection, we recognize a great number of missing values. In fact, the data frame is structured like this:</p>

<pre><code class="language-r">library(knitr)
include_graphics(&quot;facial_beauty.png&quot;)
</code></pre>

<p><img src="https://sebastiansauer.github.io/images/2017-01-06/facial_beauty.png" title="plot of chunk unnamed-chunk-3" alt="plot of chunk unnamed-chunk-3" width="20%" style="display: block; margin: auto;" /></p>

<p>Where each blue rectangle represents the &ldquo;core&rdquo; data set for one of the four conditions (mentioned above). All the grey area represents vast deserts of <code>NA</code>s.</p>

<p>That said, the data set would be much nicer if the four &ldquo;core data sets&rdquo; would be aligned beneath each other like this:</p>

<pre><code class="language-r">library(knitr)
include_graphics(&quot;beauty_aligned.png&quot;)
</code></pre>

<p><img src="https://sebastiansauer.github.io/images/2017-01-06/beauty_aligned.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" width="20%" style="display: block; margin: auto;" /></p>

<p>Of course, this would demand that the columns be the same in each blue square. And we will need a column indicating the value of the factor &ldquo;strawperson&rdquo; and a columnd for &ldquo;presentation&rdquo;. We don&rsquo;t need column headers for times, only once, as shown on the diagram.</p>

<h1 id="cutting-out-the-sub-data-frames">Cutting out the sub data frames</h1>

<p>So we will &ldquo;cut out&rdquo; each sub data frame (blue rectangle) and stick them together one beneath another.</p>

<p>Let&rsquo;s start for &ldquo;girl C&rdquo; and &ldquo;unbearbeitet&rdquo; (meaning &ldquo;raw&rdquo; or &ldquo;natural&rdquo;).</p>

<pre><code class="language-r">d_C_raw &lt;- 
  d %&gt;% 
  dplyr::select(dplyr::contains(&quot;girl_C_unbearbeitet&quot;), Alter)
</code></pre>

<p>The helper function <code>contains</code> is handy to choose the right columns.</p>

<p>Now we get rid of the empty lines. We exclude all rows where only <code>NA</code>s appear (not looking at <code>Alter</code>, were no <code>NA</code>s will pop up).</p>

<pre><code class="language-r">d_C_raw &lt;- 
  d_C_raw %&gt;% 
    filter(!is.na(girl_C_unbearbeitet_Likes) |
          !is.na(girl_C_unbearbeitet_Dislikes) |
          !is.na(girl_C_unbearbeitet_Superlikes)| 
            !is.na(girl_C_unbearbeitet_Kontaktaufnahmen) |
            !is.na(girl_C_unbearbeitet_keine_Kontaktaufnahmen))
</code></pre>

<p>Note that the <code>|</code> operator means <code>OR</code> (logical OR). So we way that we want any raw where there is no <code>NA</code> at <code>girl_C_unbearbeitet_Likes</code> or no <code>NA</code> at <code>girl_C_unbearbeitet_Dislikes</code> or no <code>NA</code> at <code>girl_C_unbearbeitet_Superlikes</code>.</p>

<p>Now we have our first &ldquo;data cubicle&rdquo;. Let&rsquo;s repeat that for the other 3 data cubicles.</p>

<p>Data frame for girl C &ldquo;beautified&rdquo;:</p>

<pre><code class="language-r">d_C_beauty &lt;-
  d %&gt;% 
  dplyr::select(dplyr::contains(&quot;girl_C_bearbeitet&quot;), Alter)

d_C_beauty &lt;- 
 d_C_beauty %&gt;% 
    filter(!is.na(girl_C_bearbeitet_Like) |
          !is.na(girl_C_bearbeitet_Dislike) |
          !is.na(girl_C_bearbeitet_Superlike) | 
            !is.na(girl_C_bearbeitet_Kontaktaufnahme) |
            !is.na(girl_C_bearbeitet_keine_Kontaktaufnahme))
</code></pre>

<p>The variable names are probably somewhat verbose, but let&rsquo;s not discuss that here. Also note that the names are not fully consistent; at times they come in plural and at times in singular form.</p>

<p>Now girl A, natural:</p>

<pre><code class="language-r">d_A_raw &lt;-
  d %&gt;% 
  dplyr::select(dplyr::contains(&quot;girl_A_unbearbeitet&quot;), Alter)

d_A_raw &lt;- 
 d_A_raw %&gt;% 
    filter(!is.na(girl_A_unbearbeitet_Like) |
          !is.na(girl_A_unbearbeitet_Dislike) |
          !is.na(girl_A_unbearbeitet_Superlike) | 
            !is.na(girl_A_unbearbeitet_Kontaktaufnahme) |
            !is.na(girl_A_unbearbeitet_keine_Kontaktaufnahme))
</code></pre>

<p>Once more for girl A, processed:</p>

<pre><code class="language-r">d_A_beauty &lt;-
  d %&gt;% 
  dplyr::select(dplyr::contains(&quot;girl_A_bearbeitet&quot;), Alter)

d_A_beauty &lt;- 
 d_A_beauty %&gt;% 
    filter(!is.na(girl_A_bearbeitet_Like) |
          !is.na(girl_A_bearbeitet_Dislike) |
          !is.na(girl_A_bearbeitet_Superlike) | 
            !is.na(girl_A_bearbeitet_Kontaktaufnahme) |
            !is.na(girl_A_bearbeitet_keine_Kontaktaufnahme))
</code></pre>

<h2 id="adjust-names-of-sub-data-frames">Adjust names of sub data frames</h2>

<p>Before we can bind the sub data frames together, we have to make sure the names of the columns are identical. So let&rsquo;s do that now. In addition, we need to save the information about the study factors (natural vs. processed; girl A vs. girl C).</p>

<pre><code class="language-r">d_A_beauty$girl &lt;- &quot;A&quot;
d_A_beauty$presentation &lt;- &quot;beauty&quot;
d_A_raw$girl &lt;- &quot;A&quot;
d_A_raw$presentation &lt;- &quot;natural&quot;


d_C_beauty$girl &lt;- &quot;C&quot;
d_C_beauty$presentation &lt;- &quot;beauty&quot;
d_C_raw$girl &lt;- &quot;C&quot;
d_C_raw$presentation &lt;- &quot;natural&quot;
</code></pre>

<p>OK, now the names of the variables:</p>

<pre><code class="language-r">names_cols &lt;- c(&quot;like_yes&quot;, &quot;like_no&quot;, &quot;superlike_yes&quot;, &quot;contact_yes&quot;, &quot;contact_no&quot;, &quot;age&quot;, &quot;girl&quot;, &quot;presentation&quot;)

names(d_A_raw) &lt;- names_cols
names(d_A_beauty) &lt;- names_cols
names(d_C_raw) &lt;- names_cols
names(d_C_beauty) &lt;- names_cols
</code></pre>

<h1 id="bind-sub-data-frames">Bind sub data frames</h1>

<p>Now we are ready to bind the four sub data frames into one, by placing the four pieces underneath each other:</p>

<pre><code class="language-r">d_long &lt;- bind_rows(d_A_raw, d_A_beauty, d_C_raw, d_C_beauty)
</code></pre>

<p>Wow! Now we have reformated our data frame from &ldquo;wide&rdquo; format to &ldquo;long&rdquo; format. Long ride.</p>

<h1 id="unite-columns">Unite columns</h1>

<p>Note that some columns are dependent: a <code>1</code> in <code>like</code> corresponds to <code>NA</code> in <code>dislike</code> and a <code>NA</code> in <code>superlike</code>. We can merge these columns into one. Same story for contact.</p>

<p>First, recode <code>NA</code>s to <code>0</code> as this it what they mean here.</p>

<pre><code class="language-r">
d_long &lt;-
  d_long %&gt;% 
  mutate_at(vars(like_yes, like_no, superlike_yes, contact_yes, contact_no), 
            recode, .missing = 0, `1` = 1)

</code></pre>

<p>A quick check:</p>

<pre><code class="language-r">count(d_long, like_yes)
#&gt; # A tibble: 2 × 2
#&gt;   like_yes     n
#&gt;      &lt;dbl&gt; &lt;int&gt;
#&gt; 1        0   404
#&gt; 2        1  1036
count(d_long,like_no)
#&gt; # A tibble: 2 × 2
#&gt;   like_no     n
#&gt;     &lt;dbl&gt; &lt;int&gt;
#&gt; 1       0  1036
#&gt; 2       1   404
</code></pre>

<p>Seems OK.</p>

<p>Next, merge the three &ldquo;like columns&rdquo; into one using <code>dplyr::case_when</code>:</p>

<pre><code class="language-r">
d_long &lt;-
  d_long %&gt;% 
  mutate(like = case_when(
    d_long$like_yes == 1 ~ &quot;like&quot;,
    d_long$like_no == 1 ~ &quot;dislike&quot;,
    d_long$superlike_yes == 1 ~ &quot;superlike&quot;))
</code></pre>

<p>Note that <code>case_when</code> will fail if there are <code>NA</code>s in your vector (without an helpful error).</p>

<p>Now we can drop the initial three &ldquo;like columns&rdquo;.</p>

<pre><code class="language-r">d_long &lt;- 
  d_long %&gt;% 
  select(-c(like_yes, like_no, superlike_yes))
</code></pre>

<p>And now same story for the two &ldquo;contact columns&rdquo;.</p>

<p>Wait, if <code>1</code> in <code>contact_yes</code> means <code>0</code> in <code>contact_no</code>, then we are already done.
Let&rsquo;s look at the counts of the two variables:</p>

<pre><code class="language-r">count(d_long, contact_yes)
#&gt; # A tibble: 2 × 2
#&gt;   contact_yes     n
#&gt;         &lt;dbl&gt; &lt;int&gt;
#&gt; 1           0   853
#&gt; 2           1   587
count(d_long, contact_no)
#&gt; # A tibble: 2 × 2
#&gt;   contact_no     n
#&gt;        &lt;dbl&gt; &lt;int&gt;
#&gt; 1          0   585
#&gt; 2          1   855
</code></pre>

<p>Hm, that&rsquo;s no exact match, but nearly. Probably some typing errors or something similar. So we can just rename one variable, drop the other, and that&rsquo;s it.</p>

<pre><code class="language-r">d_long &lt;-
  d_long %&gt;% 
  rename(contact = contact_yes) %&gt;% 
  select(-contact_no)
</code></pre>

<h1 id="debrief">Debrief</h1>

<p>That&rsquo;s about it. We have now a data frame in &ldquo;long&rdquo; format. This version is more adequat for many analyses. Have fun!</p>

<h1 id="session-info">Session info</h1>

<pre><code class="language-r">sessionInfo()
#&gt; R version 3.3.2 (2016-10-31)
#&gt; Platform: x86_64-apple-darwin13.4.0 (64-bit)
#&gt; Running under: macOS Sierra 10.12.2
#&gt; 
#&gt; locale:
#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt; [1] knitr_1.15.1 dplyr_0.5.0 
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] Rcpp_0.12.8         codetools_0.2-15    digest_0.6.11      
#&gt;  [4] rprojroot_1.1       assertthat_0.1      R6_2.2.0           
#&gt;  [7] DBI_0.5-1           backports_1.0.4     magrittr_1.5       
#&gt; [10] evaluate_0.10       highr_0.6           stringi_1.1.2      
#&gt; [13] lazyeval_0.2.0.9000 rmarkdown_1.3       tools_3.3.2        
#&gt; [16] stringr_1.1.0       rsconnect_0.7       yaml_2.1.14        
#&gt; [19] htmltools_0.3.5     tibble_1.2
</code></pre>

    </div>
  </article>

  
<section id="comments">
  <div id="disqus_thread"></div>
  <script>
  var disqus_config = function () {
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var d = document, s = d.createElement('script');
    s.src = '//https-data-se-netlify-com.disqus.com/embed.js'; s.async = true;
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>



</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>

